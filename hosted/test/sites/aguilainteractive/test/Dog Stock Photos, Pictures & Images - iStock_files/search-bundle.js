
namespacing={init:function(namespace){var spaces=[];namespace.split('.').each(function(space){var curSpace=window,i;spaces.push(space);for(i=0;i<spaces.length;i++){if(typeof curSpace[spaces[i]]==='undefined'){curSpace[spaces[i]]={};}
curSpace=curSpace[spaces[i]];}});}};function Exception(name,message)
{if(name)
this.name=name;if(message)
this.message=message;}
Exception.prototype.setName=function(name)
{this.name=name;}
Exception.prototype.getName=function()
{return this.name;}
Exception.prototype.setMessage=function(msg)
{this.message=msg;}
Exception.prototype.getMessage=function()
{return this.message;}
function FlashTag(src,width,height)
{this.src=src;this.width=width;this.height=height;this.version='7,0,14,0';this.id=null;this.bgcolor='ffffff';this.flashVars=null;this.alt='';this.title='';this.wmode='opaque';}
FlashTag.prototype.setVersion=function(v)
{this.version=v;}
FlashTag.prototype.setId=function(id)
{this.id=id;}
FlashTag.prototype.setBgcolor=function(bgc)
{this.bgcolor=bgc;}
FlashTag.prototype.setFlashvars=function(fv)
{this.flashVars=fv;}
FlashTag.prototype.setAlt=function(alt)
{this.alt=alt;}
FlashTag.prototype.setTitle=function(title)
{this.title=title;}
FlashTag.prototype.setWmode=function(wmode){this.wmode=wmode;}
FlashTag.prototype.toString=function()
{var ie=(navigator.appName.indexOf("Microsoft")!=-1)?1:0;var flashTag=new String();if(ie)
{flashTag+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ';if(this.id!=null)
{flashTag+='id="'+this.id+'" ';}
flashTag+='codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+this.version+'" ';flashTag+='width="'+this.width+'" ';flashTag+='height="'+this.height+'" ';flashTag+='alt="'+this.alt+'" ';flashTag+='title="'+this.title+'">';flashTag+='<param name="movie" value="'+this.src+'"/>';flashTag+='<param name="quality" value="high"/>';flashTag+='<param name="bgcolor" value="#'+this.bgcolor+'"/>';flashTag+='<param name="wmode" value="'+this.wmode+'">';if(this.flashVars!=null)
{flashTag+='<param name="flashvars" value="'+this.flashVars+'"/>';}
flashTag+='</object>';}
else
{flashTag+='<embed src="'+this.src+'" ';flashTag+='quality="high" ';flashTag+='bgcolor="#'+this.bgcolor+'" ';flashTag+='width="'+this.width+'" ';flashTag+='height="'+this.height+'" ';flashTag+='wmode="'+this.wmode+'" ';flashTag+='alt="'+this.alt+'" ';flashTag+='title="'+this.title+'" ';flashTag+='type="application/x-shockwave-flash" ';if(this.flashVars!=null)
{flashTag+='flashvars="'+this.flashVars+'" ';}
if(this.id!=null)
{flashTag+='name="'+this.id+'" ';}
flashTag+='pluginspage="http://www.macromedia.com/go/getflashplayer">';flashTag+='</embed>';}
return flashTag;}
FlashTag.prototype.write=function(doc)
{doc.write(this.toString());}
function FlashSerializer(useCdata)
{this.useCdata=useCdata;}
FlashSerializer.prototype.serialize=function(args)
{var qs=new String();for(var i=0;i<args.length;++i)
{switch(typeof(args[i]))
{case'undefined':qs+='t'+(i)+'=undf';break;case'string':qs+='t'+(i)+'=str&d'+(i)+'='+escape(args[i]);break;case'number':qs+='t'+(i)+'=num&d'+(i)+'='+escape(args[i]);break;case'boolean':qs+='t'+(i)+'=bool&d'+(i)+'='+escape(args[i]);break;case'object':if(args[i]==null)
{qs+='t'+(i)+'=null';}
else if(args[i]instanceof Date)
{qs+='t'+(i)+'=date&d'+(i)+'='+escape(args[i].getTime());}
else
{try
{qs+='t'+(i)+'=xser&d'+(i)+'='+escape(this._serializeXML(args[i]));}
catch(exception)
{throw new Exception("FlashSerializationException","The following error occurred during complex object serialization: "+exception.getMessage());}}
break;default:throw new Exception("FlashSerializationException","You can only serialize strings, numbers, booleans, dates, objects, arrays, nulls, and undefined.");}
if(i!=(args.length-1))
{qs+='&';}}
return qs;}
FlashSerializer.prototype._serializeXML=function(obj)
{var doc=new Object();doc.xml='<fp>';this._serializeNode(obj,doc,null);doc.xml+='</fp>';return doc.xml;}
FlashSerializer.prototype._serializeNode=function(obj,doc,name)
{switch(typeof(obj))
{case'undefined':doc.xml+='<undf'+this._addName(name)+'/>';break;case'string':doc.xml+='<str'+this._addName(name)+'>'+this._escapeXml(obj)+'</str>';break;case'number':doc.xml+='<num'+this._addName(name)+'>'+obj+'</num>';break;case'boolean':doc.xml+='<bool'+this._addName(name)+' val="'+obj+'"/>';break;case'object':if(obj==null)
{doc.xml+='<null'+this._addName(name)+'/>';}
else if(obj instanceof Date)
{doc.xml+='<date'+this._addName(name)+'>'+obj.getTime()+'</date>';}
else if(obj instanceof Array)
{doc.xml+='<array'+this._addName(name)+'>';for(var i=0;i<obj.length;++i)
{this._serializeNode(obj[i],doc,null);}
doc.xml+='</array>';}
else
{doc.xml+='<obj'+this._addName(name)+'>';for(var n in obj)
{if(typeof(obj[n])=='function')
continue;this._serializeNode(obj[n],doc,n);}
doc.xml+='</obj>';}
break;default:throw new Exception("FlashSerializationException","You can only serialize strings, numbers, booleans, objects, dates, arrays, nulls and undefined");break;}}
FlashSerializer.prototype._addName=function(name)
{if(name!=null)
{return' name="'+name+'"';}
return'';}
FlashSerializer.prototype._escapeXml=function(str)
{if(this.useCdata)
return'<![CDATA['+str+']]>';else
return str.replace(/&/g,'&amp;').replace(/</g,'&lt;');}
function FlashProxy(uid,proxySwfName)
{this.uid=uid;this.proxySwfName=proxySwfName;this.flashSerializer=new FlashSerializer(false);}
FlashProxy.prototype.call=function()
{if(arguments.length==0)
{throw new Exception("Flash Proxy Exception","The first argument should be the function name followed by any number of additional arguments.");}
var qs='lcId='+escape(this.uid)+'&functionName='+escape(arguments[0]);if(arguments.length>1)
{var justArgs=new Array();for(var i=1;i<arguments.length;++i)
{justArgs.push(arguments[i]);}
qs+=('&'+this.flashSerializer.serialize(justArgs));}
var divName='_flash_proxy_'+this.uid;if(!document.getElementById(divName))
{var newTarget=document.createElement("div");newTarget.id=divName;document.body.appendChild(newTarget);}
var target=document.getElementById(divName);var ft=new FlashTag(this.proxySwfName,1,1);ft.setVersion('6,0,65,0');ft.setFlashvars(qs);ft.setWmode('');target.innerHTML=ft.toString();}
FlashProxy.callJS=function()
{var functionToCall=eval(arguments[0]);var argArray=new Array();for(var i=1;i<arguments.length;++i)
{argArray.push(arguments[i]);}
functionToCall.apply(functionToCall,argArray);}
Event.observe(document,'dom:loaded',function(){namespacing.init('istock.Modal');istock.Modal=Class.create({initialize:function(options){this._options={bgId:'ajaxWinBG',modalClass:'modalDialog',bgEvents:{}};Object.deepExtend(this._options,options||{});this._body=$$('body')[0];this._bg=new Element('div',{id:this._options.bgId});this._modal=new Element('div',{'class':this._options.modalClass});},show:function(){this._body.insert({top:this._bg});this._body.insert({top:this._modal});this._bg.setStyle({display:'none'});this._modal.setStyle({display:'none'});this._showBg();},hide:function(){this._hideModal();},_hideBg:function(){var events=this._options.bgEvents,key;this._bg.stopObserving();this._bg.fade({duration:0.2,afterFinish:function(){this._bg.remove();this._body.setStyle({overflow:'auto'});}.bind(this)});},_hideModal:function(){this._modal.fade({duration:0.2,afterFinish:function(){this._hideBg();this._modal.remove();}.bind(this)});},_showBg:function(){var style={},scrollOffsets=document.viewport.getScrollOffsets(),viewportDims=document.viewport.getDimensions(),events=this._options.bgEvents,key;style.width=(viewportDims.width*3)+scrollOffsets.left+'px';style.height=(viewportDims.height*3)+scrollOffsets.top+'px';style.left=scrollOffsets.left+'px';style.top=scrollOffsets.top+'px';this._bg.setStyle(style);this._body.setStyle({overflow:'hidden'});for(key in events){if(events.hasOwnProperty(key)&&events[key]){this._bg.observe(key,events[key].bind(this));}}
this._bg.appear({duration:0.3,from:0,to:0.5,afterFinish:this._showModal.bind(this)});},_showModal:function(){this._reposition();this._modal.setStyle({display:'none'});this._modal.appear({duration:0.3});},_reposition:function(){var pos;this._modal.show();pos=this._getCenter();this._modal.setStyle({left:pos.left+'px',top:pos.top+'px'});},_getCenter:function(){var vp=document.viewport.getDimensions(),scroll=document.viewport.getScrollOffsets(),modal={width:this._modal.getLayout().get('margin-box-width'),height:this._modal.getLayout().get('margin-box-height')},center={};center.left=Math.floor(((vp.width/2)+scroll.left)-(modal.width/2));center.top=Math.floor(((vp.height/2)+scroll.top)-(modal.height/2));return center;}});namespacing.init('istock.History');istock.History=Class.create({state:'',iframe:null,handlers:{generic:[],specific:{}},extractHash:function(url){var hash=url.replace(/^[^#]*#/,'').replace(/^#+|#+$/,'').replace(/\?.*/,'');return hash;},getState:function(){return this.state;},setState:function(state){this.state=this.extractHash(state);return this.state;},getHash:function(){return this.extractHash(window.location.hash||location.hash);},setHash:function(hash){hash=this.extractHash(hash);startIndex=window.location.hash.indexOf('?');if(startIndex>0){args=window.location.hash.substring(startIndex,window.location.hash.length);hash=hash+args;}
if(window.location.hash&&window.location.hash!==hash){window.location.hash=hash;}else if(location.hash!==hash){location.hash=hash;};return hash;},go:function(state){state=this.extractHash(state);if(state!==this.getHash()){this.setHash(state);}else{if(state!==this.getState()){this.setState(state);}
this.trigger();};},hashchange:function(){if(this.getState()!==this.getHash()){this.go(this.getHash());}},setHandler:function(state,handler){if(handler){if(typeof this.handlers.specific[state]==='undefined'){this.handlers.specific[state]=[];};this.handlers.specific[state].push(handler);}else{handler=state;this.handlers.generic.push(handler);};},trigger:function(state){var i,handler,list;if(typeof state==='undefined'){state=this.getState();};list=this.handlers.generic.clone();if(typeof this.handlers.specific[state]!=='undefined'){list=list.concat(this.handlers.specific[state]);};for(i=0;i<list.length;i++){handler=list[i];handler(state);};return true;},supported:function(){var browser=Prototype.Browser,version=browser.Version;if(browser.IE&&version[0]>=8){return true;}else if(browser.Gecko){if(version[0]>1){return true;}
else if(version[0]===1&&version[1]>9){return true;}
else if(version[0]===1&&version[1]===9&&version[2]>=2){return true;}}else if(browser.Opera){if(version[0]>10){return true;}
else if(version[0]===10&&version[1]>=60){return true;}}else if(browser.WebKit&&version[0]>=528){return true;}
return false;},hashchangeEmulation:function(){var checker,iframeHit,doc,pe,browser=Prototype.Browser;if(!this.supported()){if(browser.IE){this.iframe=new Element('iframe',{id:'istock-history-iframe',style:'display:none'});$$('body')[0].insert({top:this.iframe});doc=this.iframe.contentWindow.document;doc.open();doc.close();iframeHit=false;checker=function(){var hash=this.getHash(),state=this.getState(),iframeHash=this.extractHash(this.iframe.contentWindow.document.location.hash);if(!hash.blank()&&state!==hash){if(!iframeHit){doc.open();doc.close();doc.location.hash=hash;};iframeHit=false;Event.fire(document,'search:hashchange');}else{if(state!==iframeHash){iframeHit=true;this.setHash(iframeHash);};};}.bind(this);}else{checker=function(){if(!this.getHash().blank()&&this.getState()!==this.getHash()){Event.fire(document,'search:hashchange');};};}
pe=new PeriodicalExecuter(checker.bind(this),0.2);}},initialize:function(){Event.observe(window,'hashchange',this.hashchange.bind(this));Event.observe(document,'search:hashchange',this.hashchange.bind(this));setTimeout(this.hashchangeEmulation.bind(this),200);}});namespacing.init('istock.calc');istock.calc.crc32=function(str){var crcTable=null,c=0xFFFFFFFF,sL=str.length,n,crcTableCalc=function(){var i=0,k=0,c;if(crcTable){return;}
crcTable=new Array(256);for(i=0;i<256;i++){c=i;for(k=0;k<8;k++){c=(c&1)?0xEDB88320^(c>>1):c>>1;}
crcTable[i]=c;}};crcTableCalc();for(n=0;n<sL;n++){c=crcTable[(c^str.charCodeAt(n))&0xff]^(c>>8);}
return Math.abs(c^0xffffffff).toString(16);};namespacing.init('istock.search.templates');istock.search.templates.paginator=new Template('<div class="paginator">'+'<div class="paginatorLeft">#{left}</div>'+'<div class="paginatorRight">#{right}</div>'+'</div>');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.pageJump=new Template('<input type="text" class="#{eventClass} paginatorJump" value="" />');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.button=new Template('<a href="#">'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="#{eventClass} pg#{page} #{otherClass}" />'+'</a>');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.link=new Template('<a href="#" class="#{eventClass} pg#{page} #{otherClass} paginatorLink">'+'#{text}'+'</a>');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.right=new Template('#{firstButton}'+'#{prevButton}'+'#{pages}'+'#{pageJump}'+'<span>#{ofLabel}</span> '+'#{lastButton}'+'#{nextButton}');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.topLeft=new Template('<label for="sortBy">#{sortLabel}</label>'+'<select id="sortBy" class="e_sortBy">'+'#{sortByOptions}'+'</select>'+'<label for="perPageTop">#{perPageLabel}</label>'+'<select id="perPageTop" class="e_filesPerPage">'+'#{perPageOptions}'+'</select>');namespacing.init('istock.search.templates.paginator');istock.search.templates.paginator.bottomLeft=new Template('#{displaySettings}');namespacing.init('istock.search.templates.audio');istock.search.templates.audio.container=new Template('<div id="listSearchResults">'+'<div class="lsrHeader">'+'<div class="colPlay">&nbsp;</div>'+'<div class="colTitle">#{heading.title}</div>'+'<div class="colContributor">#{heading.contributor}</div>'+'<div class="colDuration">#{heading.duration}</div>'+'<div class="colDownloads">#{heading.downloads}</div>'+'<div class="colLightbox">&nbsp;</div>'+'<div class="coladdToCart">&nbsp;</div>'+'</div>'+'<div class="lsrBody">'+'#{rows}'+'</div>'+'</div>');namespacing.init('istock.search.templates.audio');istock.search.templates.audio.row=new Template('<div class="lsrRow #{extraClass}" id="lsrRow_#{id}">'+'<div class="colPlay"><img id="playPause_#{id}" src="'+istock.cookielessUrl+'/static/images/blank.gif" class="e_listPlayer click playAudio 1 #{id}" /></div>'+'<div class="colTitle"><a href="/icons.php" target="icons" class="fileTypeIcon"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="icons #{audioIcon}"></a><a href="#{url.page}?st=#{searchToken}"><span class="audioTitle">#{title}</span></a></div>'+'<div class="colContributor"><a href="/user_view.php?id=#{contributor.id}">#{contributor.username}</a></div>'+'<div class="colDuration">#{audio.duration}</div>'+'<div class="colDownloads">#{downloadCount}</div>'+'<div class="colLightbox">#{lightboxIcon}</div>'+'<div class="coladdToCart">#{addToCartIcon}</div>'+'<div class="cl"></div>'+'<div class="lsrDetails" id="lsrDetails_#{id}" style="display:none;">'+'<div class="lsrDetailsTable">'+'<div class="colFlash" id="istock_audioplayer_listview_#{id}" style="display:none">'+'#{flv}'+'</div>'+'<div class="colFileCloseUp">'+'<a href="#{url.page}?st=#{searchToken}"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="fileDetails" alt="##{id}" title="##{id}" /></a>'+'</div>'+'<div class="colDetails">'+'<div id="description_#{id}" class="description">&nbsp;<br />&nbsp;</div>'+'<div class="rating">'+'<span>#{ratingLabel}</span> '+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<span class="reviews" id="reviews_#{id}">#{retrievingRating}</span>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div class="cl"></div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.searchResult=new Template('<div id="srItem_#{id}" class="srItem #{otherClass}">'+'<div class="srFile">'+'#{saleIcon}'+'#{flamesIcon}'+'<a href= "#{url.page}?st=#{searchToken}">'+'<img src="#{url.thumbnail}" class="e_loupe srThumbnail" id="thumbnail_#{id}" alt="#{title}" />'+'</a>'+'</div>'+'<div class="srMeta">'+'<div class="srIcons">'+'#{fileTypeIcon}'+'#{editorialIcon}'+'#{exclusiveIcon}'+'#{addToCartIcon}'+'#{lightboxIcon}'+'</div>'+'<div>'+'<span class="srFileNumber"><a href="#{url.page}?st=#{searchToken}">##{id}</a></span>'+'</div>'+'<div class="srTitle trnct">#{title}</div>'+'<div class="srContributor trnct"><a href="/user_view.php?id=#{contributor.id}">#{contributor.username}</a></div>'+'<div class="srDownload">Downloads: #{downloadCount}</div>'+'</div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.zeroResult=new Template('<div id="zeroResult">'+'<div class="heading">#{title}</div>'+'<h2>#{suggestionsTitle}</h2>'+'<div class="suggestions">'+'<span>#{suggestionsHeading}</span>'+'<ul>'+'#{suggestions}'+'</ul>'+'</div>'+'<div class="categoryLinks">'+'<div class="title">#{categoriesTitle}</div>'+'<ul id="categoriesLeft">'+'#{categoriesLeft}'+'</ul>'+'<ul id="categoriesRight">'+'#{categoriesRight}'+'</ul>'+'<br class="cl" />'+'</div>'+'<div class="tipsLink">'+'#{tipTitle}'+'<a href= "#{tipUrl}" target="_blank">#{tipUrlText}</a>.'+'</div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.nextResultSetButton=new Template('<div class="srItem preview nextButton lastRow">'+'<div class="srFile">'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="#{eventClass} pg#{page} nextResultSet" alt="Next Page" title="Next Page" />'+'</div>'+'<div class="srMeta">'+'<div class="srIcons">'+'</div>'+'<div class="srTitle trnct"></div>'+'<div class="srContributor"></div>'+'<div class="srDownload"></div>'+'</div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.displaySettings=new Template('<div id="displaySettingsContainer" class="menuSelector ims-click">'+'<div id="displaySettingsHeader" class="menuSelector-header">'+'<a href="#" class="moreArrowDown" id="dispSettingsLink">'+'<span>#{displaySettingsLabel}</span>'+'</a>'+'</div>'+'<div class="menuSelector-content" style="display:none;">'+'<div class="displaySettingsContent">'+'<div class="displaySettingsFilters dsContainer">'+'<div class="heading">#{fileDetailsTitle}</div>'+'<div class="displaySettingsItems">'+'<input type="checkbox" class="e_dispSetting srTitle" id="displaySettingsTitles" #{title.checked} />'+'<label for="displaySettingsTitles">#{title.label}</label><br />'+'<input type="checkbox" class="e_dispSetting srContributor" id="displaySettingsContributor" #{contributor.checked} />'+'<label for="displaySettingsContributor">#{contributor.label}</label><br />'+'<input type="checkbox" class="e_dispSetting srFileNumber" id="displaySettingsFileNum" #{fileNumber.checked} />'+'<label for="displaySettingsFileNum">#{fileNumber.label}</label>'+'</div>'+'<div class="displaySettingsItems">'+'<input type="checkbox" class="e_dispSetting srDownload" id="displaySettingsDownloads" #{downloads.checked} />'+'<label for="displaySettingsDownloads">#{downloads.label}</label><br />'+'<input type="checkbox" class="e_dispSetting srLoupe" id="displaySettingsLoupe" #{loupe.checked} />'+'<label for="displaySettingsLoupe">#{loupe.label}</label>'+'</div>'+'</div>'+'<div class="displaySettingsAdultContent dsContainer">'+'<div class="heading">#{adultContent.title}</div>'+'<label><input type="checkbox" value="0" class="e_dispSetting srAdultContent" id="displaySettingsAdultContent" #{adultContent.checked} />'+'#{adultContent.label}</label>'+'</div>'+'#{editorialDisplaySettings}'+'<br class="clear" />'+'</div>'+'</div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.editorialDisplaySettings=new Template('<div class="displaySettingsAlwaysExcludeEditorial dsContainer">'+'<div class="heading">#{alwaysExcludeEditorial.title}</div>'+'<label><input type="checkbox" value="0" class="e_dispSetting srAlwaysExcludeEditorial" id="displaySettingsAlwaysExcludeEditorial" #{alwaysExcludeEditorial.checked} />'+'#{alwaysExcludeEditorial.label}</label>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.icon=new Template('<img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="#{icon} icons" title="#{title}" alt="#{title}" />');namespacing.init('istock.search.templates');istock.search.templates.cartIcon=new Template('<img src="'+istock.cookielessUrl+'/static/images/blank.gif" id="#{id}" class="#{icon} iconsWide"  title="#{title}" alt="#{title}" />');namespacing.init('istock.search.templates');istock.search.templates.imageLink=new Template('<a href="#{url}" #{target}>'+'#{icon}'+'</a>');namespacing.init('istock.search.templates');istock.search.templates.editorialInfo=new Template('<div class="loupeEditorial"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="icons editorial" /> <span>#{editorialUseOnly}</span></div>');namespacing.init('istock.search.templates');istock.search.templates.option=new Template('<option value="#{value}" #{selected}>#{label}</option>');namespacing.init('istock.search.templates');istock.search.templates.disambigTerm=new Template('<li><input type="checkbox" value="#{termId}" id="d#{termId}" #{checked} /><label for="d#{termId}">#{label}</label><li>');namespacing.init('istock.search.templates');istock.search.templates.spellingCorrection=new Template('<li class="spellingCorrection"><a href="#">#{label}</a><input type="hidden" value="#{action}" /></li>');namespacing.init('istock.search.templates');istock.search.templates.listItem=new Template('<li>#{text}</li>');namespacing.init('istock.search.templates');istock.search.templates.categoryLink=new Template('<li><a href="/royalty-free/#{url}">#{text}</a></li>');namespacing.init('istock.search.templates');istock.search.templates.categoryTag=new Template('<li><div class="e_custom click istock.search.ZeroResults selectCategory #{categoryId} categoryLink"><a href="/royalty-free/#{url}">#{text}</a></div></li>');namespacing.init('istock.search.templates');istock.search.templates.crearifySearch=new Template('<div id="clarifyContainer">'+'<div>'+'<div class="clarifyIcon"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="spellingIcon" /></div>'+'<span>#{incorrectSpelling}</span>'+'</div>'+'<div>'+'<div class="clarifyIcon"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="disambiguation" /></div>'+'<span>#{multipleMeanings}</span>'+'</div>'+'<br class="cl" />'+'<div class="dontShowClarify">'+'<input type="checkbox" id="dontShowClarify" />'+'<label for="dontShowClarify">#{dontShow}</label>'+'</div>'+'</div>');namespacing.init('istock.search.templates');istock.search.templates.saleIcon=new Template('<img src="'+istock.cookielessUrl+'/static/images/icons/sale/#{saleIconType}/#{lang}.gif" class="fl"/>');namespacing.init('istock.search');istock.search.listPlayers={players:new Hash(),current:null,play:function(id,toggle){var player=this._getPlayer(id);if(player){player.play(toggle);}},pause:function(id){var player=this._getPlayer(id);if(player){player.pause();}},clearPlayers:function(){if(this.current){this.current.pause(true);}
this.current=null;},_getPlayer:function(id){var player;if((player=this.players.get(id))){return player;}}};istock.search.ListPlayer=Class.create({ID_PREFIX:'playPause_',AUDIO_PREVIEW:'/audio_mp3_preview.php',initialize:function(data){this._id=data.id;this._duration=data.duration;istock.search.listPlayers.players.set(this._id,this);},getId:function(){return this._id;},play:function(togglePlayer){var currentPlayer=istock.search.listPlayers.current;if(this._transitioning){return;}
if(currentPlayer&&currentPlayer.getId()!==this._id){currentPlayer.pause(true);}
togglePlayer=!!parseInt(togglePlayer,10);if(togglePlayer){this._toggleRow();this.start(true);}else{this.start(false);}
istock.search.listPlayers.current=this;},pause:function(toggleEnabled){this._flashProxy.call('execAudioCommand','stop');this._setStyleClass((toggleEnabled?this._classSets[0]:this._classSets[1]));},start:function(toggleEnabled){this._flashProxy.call('execAudioCommand','start');this._setStyleClass((toggleEnabled?this._classSets[2]:this._classSets[3]));},_toggleRow:function(){var currentPlayer=istock.search.listPlayers.current,currentId,isOpening,flvContainer=$('istock_audioplayer_listview_'+this._id),dataRow=$('lsrDetails_'+this._id);if(flvContainer.innerHTML.empty()){flvContainer.insert(this._getFlashObj().toString());}
if(currentPlayer&&(currentId=currentPlayer.getId())!==this._id){$('istock_audioplayer_listview_'+currentId).toggle();Effect.toggle('lsrDetails_'+currentId,'blind',{duration:0.2});}
isOpening=dataRow.visible();Effect.toggle(dataRow,'blind',{duration:0.2,beforeStart:function(){this._transitioning=true;if(isOpening){flvContainer.hide();}},afterFinish:function(){this._transitioning=false;if(!isOpening){flvContainer.show();if($('description_'+this._id).className.indexOf('set')<0){this._getMetaData();}}}.bind(this)});},_getMetaData:function(){var metadata=new istock.search.results.Metadata(this._id);metadata.request({onSuccess:this._updateMetaData.bind(this)});},_updateMetaData:function(data){var description=$('description_'+this._id),reviews=$('reviews_'+this._id),ratingIcons=$$('#lsrDetails_'+this._id+' .ratingIcon'),rating;description.update(data.description);description.truncate(350,2);description.addClassName('set');reviews.update(translations.search.metadata.reviewsLabel.replace('%s',data.rating.RatingCount));if(data.rating.RatingCount>0){rating=parseFloat(data.rating.RatingsAverage);ratingIcons.each(function(icon){if(parseInt(rating,10)>0){rating--;icon.removeClassName('loupeCamera0');icon.addClassName('loupeCamera10');}else if(rating>0.0&&parseInt(rating,10)===0){rating=0;icon.removeClassName('loupeCamera0');icon.addClassName('loupeCamera5');}});}},_getFlashObj:function(){var params='',flv;params+='lcId='+this._id+'&';params+='videoLocation='+this.AUDIO_PREVIEW+'?';params+='id='+this._id+'&';params+='totalTime='+this._duration;flv=new FlashTag(istock.cookielessUrl+'/static/flash/audioPlayer-listview.swf','325','30');flv.setWmode('opaque');flv.setBgcolor('f6f6f6');flv.setFlashvars(params);this._flashProxy=new FlashProxy(this._id,istock.cookielessUrl+'/static/flash/JavaScriptFlashGateway.swf');return flv;},_setStyleClass:function(classNames){var el=$(this.ID_PREFIX+this._id),curClassName=el&&el.className||[];this._classSets.each(function(curVal){if(curClassName.indexOf(curVal)>0){el.className=el.className.replace(curVal,classNames);return;}});},_classSets:['playAudio 1','playAudio 0','pauseAudio 1','pauseAudio 0'],_transitioning:false});window.audioStartCallback=function(){var current=istock.search.listPlayers.current;if(current){current.play(false);}};window.audioStopCallback=function(){var current=istock.search.listPlayers.current;if(current){current.pause(false);}};document.observe('search:loaded',function(){var players=istock.search.listPlayers;document.observe(istock.search.event.ADD_FACET,players.clearPlayers.bind(players));document.observe(istock.search.event.REMOVE_FACET,players.clearPlayers.bind(players));document.observe(istock.search.event.NEW_PAGE,players.clearPlayers.bind(players));});namespacing.init('istock.search');istock.search.Disambiguation=Class.create(istock.Infotip,{initialize:function($super,name,term){this._termIds=[];this._options={title:translations.search.disambiguation.title,anchor:null,contents:this._buildContents(term),attachOptions:{anchor:{horizontal:'right',vertical:'middle',ignore:'margin'},attachee:{horizontal:'left',vertical:'middle'}}};this._closeTimeoutId=null;this._name=name;$super(this._options);istock.Infotip.addToRegistry(this);},show:function($super,container){var disambiguations=istock.search.disambiguations,infoTip;this._anchor=container;for(infoTip in disambiguations){if(disambiguations.hasOwnProperty(infoTip)){disambiguations[infoTip].close();};};$super();},_build:function($super){var container=$super(),checkboxes=container.select('input[type="checkbox"]'),self=this;checkboxes.each(function(checkbox){checkbox.observe('click',function(){var termId=checkbox.value;self._updateFacets(termId,checkbox.checked);}.bind(this));}.bind(this));container.observe('mouseover',function(){this._clearTimeout();}.bind(this));container.observe('mouseout',function(){this._setTimeout(0);}.bind(this));this._anchor.observe('mouseout',function(){this._setTimeout(2000);}.bind(this));this._anchor.observe('mouseover',function(){this._clearTimeout();}.bind(this));},_updateFacets:function(termId,shouldAdd){var oldTermIds=this._termIds.clone();if(shouldAdd&&this._termIds.indexOf(termId)<0){this._termIds.push(termId);}else if(!shouldAdd&&this._termIds.indexOf(termId)>=0){this._termIds=this._termIds.without(termId);}
istock.search.event.fire(istock.search.event.REMOVE_FACET,istock.search.Facet.factory(istock.search.facetTypes.DISAMBIGUATION,oldTermIds,this._name));if(this._termIds.length>0){istock.search.event.fire(istock.search.event.ADD_FACET,istock.search.Facet.factory(istock.search.facetTypes.DISAMBIGUATION,this._termIds,this._name));};},_buildContents:function(term){var i=0,contents='<ul class="disambiguationList">',userSelected;userSelected=this._hasSelected(term);for(i=0;i<term.length;i++){if(term[i].selected||(!userSelected&&term[i].recommended)){this._termIds.push(term[i].termId);term[i].checked='checked="checked"';}
contents+=istock.search.templates.disambigTerm.evaluate(term[i]);};contents+='</ul>';return contents;},_hasSelected:function(terms){var i;for(i=0;i<terms.length;i++){if(terms[i].selected){return true;};};return false;}});Event.observe(document,'search:loaded',function(){document.observe(istock.search.event.NEW_RESULTS,function(){istock.search.disambiguations={};});document.observe(istock.search.event.DISAMBIG_DETECTED,function(data){var key;istock.search.disambiguations={};for(key in data.memo){if(data.memo.hasOwnProperty(key)){istock.search.disambiguations[key]=new istock.search.Disambiguation(key,data.memo[key]);};};});document.observe(istock.search.event.DISAMBIG_REQUESTED,function(data){if(data.memo.container.hasAttachedChildren()&&data.memo.container.attachedChildren[0].visible()){return;}
istock.search.disambiguations[data.memo.title].show(data.memo.container);});});namespacing.init('istock.search');istock.search.CrearifyInfo=Class.create(istock.Infotip,{initialize:function($super){this._options={title:translations.search.crearifyInfo.title,anchor:null,contents:this._buildContents(),attachOptions:{anchor:{horizontal:'right',vertical:'top',ignore:'margin'},offset:{top:20},attachee:{horizontal:'left',vertical:'middle'}}};this._closeTimeoutId=null;$super(this._options);istock.Infotip.addToRegistry(this);},show:function($super,container){this._anchor=container;$super();this._infoTip.observe('mouseover',function(){this._clearTimeout();}.bind(this));this._infoTip.observe('mouseout',function(){this._setTimeout(4000);}.bind(this));this._setTimeout(4000);$('dontShowClarify').observe('click',function(){this._dontShow();}.bind(this));},_dontShow:function(){var createCookie=function(name,value,days){var date,expires;date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; path=/";}
this.close();if(istock.localStorage){istock.localStorage.setItem('istock_dontShowClarifyTip','true');}else{createCookie('dontShowClarify','true',260);}},_buildContents:function(){var template=istock.search.templates.crearifySearch,t=translations.search.crearifyInfo,contents;contents=template.evaluate({dontShow:t.dontShow,incorrectSpelling:t.spelledWrong,multipleMeanings:t.multipleMeanings});return contents;}});Event.observe(document,'search:loaded',function(){var crearify=new istock.search.CrearifyInfo(),displayed=false,readCookie=function(name){var nameEQ=name+"=",ca=document.cookie.split(';'),i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)===' '){c=c.substring(1,c.length);}
if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length);}}
return null;},dontDisplay=function(){if(istock.localStorage&&istock.localStorage.getItem('istock_dontShowClarifyTip')==='true'){return true;}else if(!istock.localStorage){if(readCookie('dontShowClarify')==='true'){return true;}}
return false;};document.observe(istock.search.event.NEW_RESULTS,function(){crearify.close();displayed=false;});document.observe('Infotip:Opening',function(evt){if(crearify._timestamp!==evt.memo.timestamp){crearify.close();displayed=false;}});document.observe(istock.search.event.DISAMBIG_DETECTED,function(data){if(!displayed&&!dontDisplay()){displayed=true;crearify.show($('breadbox'));}});document.observe(istock.search.event.SPELLING_DETECTED,function(data){if(!displayed&&!dontDisplay()){displayed=true;crearify.show($('breadbox'));}});});namespacing.init('istock.search');istock.search.Spelling=Class.create(istock.Infotip,{initialize:function($super,name,terms){var contents;this._termIds=[];this._options={title:translations.search.spelling.title,anchor:null,contents:'',attachOptions:{anchor:{horizontal:'right',vertical:'middle',ignore:'margin'},attachee:{horizontal:'left',vertical:'middle'}}};contents=this._buildContents(terms);this._options.contents=contents;this._closeTimeoutId=null;this._name=name;$super(this._options);istock.Infotip.addToRegistry(this);},show:function($super,container){var spellings=istock.search.spellings,infoTip;this._anchor=container;for(infoTip in spellings){if(spellings.hasOwnProperty(infoTip)){spellings[infoTip].close();};};$super();},_build:function($super){var container=$super(),corrections=container.select('a'),self=this;corrections.each(function(correction){correction.observe('click',function(e){var term=correction.siblings()[0].value;self._updateFacets(term);self.close();e.stop();}.bind(this));}.bind(this));container.observe('mouseover',function(){this._clearTimeout();}.bind(this));container.observe('mouseout',function(){this._setTimeout(0);}.bind(this));this._anchor.observe('mouseout',function(){this._setTimeout(2000);}.bind(this));this._anchor.observe('mouseover',function(){this._clearTimeout();}.bind(this));},_updateFacets:function(term){var noCorrections=(term==='remove_keyword');istock.search.event.fire(istock.search.event.REMOVE_FACET,istock.search.Facet.factory(istock.search.facetTypes.KEYWORD,this._name,this._name),noCorrections);if(!noCorrections){istock.search.event.fire(istock.search.event.ADD_FACET,istock.search.Facet.factory(istock.search.facetTypes.KEYWORD,term,term));}},_buildContents:function(terms){var i=0,contents='<ul class="spellingCorrections">';if(terms.length<=0){this._options.title='No keyword found...';contents+=istock.search.templates.spellingCorrection.evaluate({label:'Remove keyword',action:'remove_keyword'});}else{for(i=0;i<terms.length;i++){contents+=istock.search.templates.spellingCorrection.evaluate({label:terms[i],action:terms[i]});};}
contents+="</ul>";return contents;}});Event.observe(document,'search:loaded',function(evt){document.observe(istock.search.event.NEW_RESULTS,function(){istock.search.spellings={};});document.observe(istock.search.event.SPELLING_DETECTED,function(data){var key;istock.search.spellings={};for(key in data.memo){if(data.memo.hasOwnProperty(key)){istock.search.spellings[key]=new istock.search.Spelling(key,data.memo[key]);};};});document.observe(istock.search.event.SPELLING_REQUESTED,function(data){if(data.memo.container.hasAttachedChildren()&&data.memo.container.attachedChildren[0].visible()){return;}
istock.search.spellings[data.memo.title].show(data.memo.container);});});namespacing.init('istock.search');istock.search.GettyLinks=Class.create({_facetStack:null,LINK_AND_VIDEO_AND_IMAGE:translations.search.gettyLinks.linkAndVideoAndImage,LINK_AND_IMAGE:translations.search.gettyLinks.linkAndSomething,LINK_AND_VIDEO:translations.search.gettyLinks.linkAndSomething,JUST_LINK:translations.search.gettyLinks.justLink,JUST_TIPS:translations.search.gettyLinks.justTips,initialize:function(){this._facetStack=new istock.search.FacetStack();Event.observe(document,istock.search.event.ADD_FACET,function(event){this._facetStack.addFacet(event.memo.facet);this._updateLinks();}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){this._facetStack.removeFacet(event.memo.facet);this._updateLinks();}.bind(this));},_fileType:function(){return istock.search.filters.FileType.getTypes();},_updateLinks:function(){$(istock.search.GettyLinks.ELEMENT_ID).addClassName('gettyLinks')
if(istock.loggedin){$(istock.search.GettyLinks.ELEMENT_ID).removeClassName('gettyLinksLoggedOut').update(this._generateLink());}else{$(istock.search.GettyLinks.ELEMENT_ID).addClassName('gettyLinksLoggedOut').update(this._generateLink());}
document.fire('omniture:gettyLink');},_regExp:function(num){return new RegExp("\<a"+num+"\>.*\<\/a"+num+"\>");},_generateLink:function(){if(this._isInStack([this._fileType().PHOTO,this._fileType().VIDEO])||this._isInStack([this._fileType().ILLUSTRATION,this._fileType().VIDEO])||this._stackFileTypeSize()===0){var linkText=this._linkText(this.LINK_AND_VIDEO_AND_IMAGE);linkText=linkText.replace(this._regExp(2),'gettyimages.com');linkText=linkText.replace(this._regExp(3),this._imageLink());linkText=linkText.replace(this._regExp(4),this._videoLink());return linkText;}else if((this._isInStack([this._fileType().PHOTO])&&this._stackFileTypeSize()===1)||(this._isInStack([this._fileType().ILLUSTRATION])&&this._stackFileTypeSize()===1)||(this._isInStack([this._fileType().PHOTO,this._fileType().ILLUSTRATION])&&this._stackFileTypeSize()===2)){var linkText=this._linkText(this.JUST_LINK);linkText=linkText.replace(this._regExp(2),this._gettyLink());return linkText;}else if((this._isInStack([this._fileType().ILLUSTRATION])||this._isInStack([this._fileType().PHOTO]))&&!this._isInStack([this._fileType().VIDEO])){var linkText=this._linkText(this.LINK_AND_IMAGE);linkText=linkText.replace(this._regExp(2),'gettyimages.com');linkText=linkText.replace(this._regExp(3),this._imageLink());return linkText;}else if(this._isInStack([this._fileType().VIDEO])){var linkText=this._linkText(this.LINK_AND_VIDEO);linkText=linkText.replace(this._regExp(2),'gettyimages.com');linkText=linkText.replace(this._regExp(3),this._videoLink());return linkText;}else{return this._linkText(this.JUST_TIPS);}},_stackFileTypeSize:function(){return this._facetStack.facets(istock.search.facetTypes.FILE_TYPE).size();},_isInStack:function(fileTypes){var found=true;fileTypes.each(function(fileType){found=found&&!Object.isUndefined(this._findInStack(fileType));}.bind(this));return found;},_findInStack:function(fileType){return this._facetStack.facets(istock.search.facetTypes.FILE_TYPE).find(function(facet){return parseInt(facet.value)===parseInt(fileType);}.bind(this));},_linkText:function(linkPart){return translations.search.gettyLinks.cantFind
+" "
+linkPart.replace(this._regExp(1),this._searchTipsLink());},_searchTipsLink:function(){return'<a target="_blank" href="/search/tips">'+translations.search.zeroResults.searchTips+'</a>';},_gettyLink:function(){return'<a class="trackSisterSite" target="_blank" href="http://www.gettyimages.com/Search/Search.aspx/1/creative?language=EN_US&esource=iStock_Search_Lk_img&license=rm,rr,rf&phrase='+this._searchPhrase()+'&purpose=GettySearch_link">'
+'gettyimages.com'
+'</a>';},_imageLink:function(){return'<a class="trackSisterSite" target="_blank" href="http://www.gettyimages.com/Search/Search.aspx/1/creative?language=EN_US&esource=iStock_Search_Lk_img&license=rm,rr,rf&phrase='+this._searchPhrase()+'&purpose=GettySearch_link">'
+translations.search.gettyLinks.images
+'</a>';},_videoLink:function(){return'<a class="trackSisterSite" target="_blank" href="http://www.gettyimages.com/Search/Search.aspx/1/footage?language=EN_US&esource=iStock_Search_Lk_vid&license=rr,rf&phrase='+this._searchPhrase()+'&purpose=GettySearch_link">'
+translations.search.gettyLinks.videos
+'</a>';},_searchPhrase:function(){var phrases=[];this._facetStack.facets(istock.search.facetTypes.KEYWORD).each(function(facet){phrases.push('('+facet.value+')');});return phrases.join('+AND+');}});Object.extend(istock.search.GettyLinks,{ELEMENT_ID:'gettyLinks',show:function(){$(this.ELEMENT_ID).show();},hide:function(){$(this.ELEMENT_ID).hide();}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.GettyLinks()});namespacing.init('istock.search');istock.search.preferences={_prefs:null,_timeoutId:null,init:function(prefs){istock.search.preferences._prefs=prefs;},get:function(pref){var prefs=istock.search.preferences._prefs;if(typeof prefs.SearchParams[pref]!=='undefined'){return prefs.SearchParams[pref];}else if(typeof prefs.SearchParamsDefault[pref]!=='undefined'){return prefs.SearchParamsDefault[pref];}else{return null;}},set:function(pref,value){var self=istock.search.preferences;self._prefs.SearchParams[pref]=value;self.save();},save:function(){var self=istock.search.preferences;this._clearTimeout();this._timeoutId=setTimeout(function(){self._sendPrefs();},2000);},_sendPrefs:function(){var a=new Ajax.Request('/json/saveSearchSettings',{method:'post',parameters:istock.search.preferences._prefs.SearchParams,onComplete:function(){}});},_clearTimeout:function(){var self=istock.search.preferences;if(self._timeoutId!==null){clearTimeout(self._timeoutId);self._timeoutId=null;}}};namespacing.init('iistock.search.paginator.sortTypesock.search');istock.search.paginator={PADDING:2,_sortTypes:{BY_PHOTOGRAPHER:1,BY_TITLE:2,BY_SIZE:3,BY_AGE:4,BY_RATING:5,BY_BEST_MATCH:6,BY_DOWNLOADS:7,BY_TEMPO:8,BY_KEY:9},render:function(){var self=istock.search.paginator,templates=istock.search.templates,template=templates.paginator,data={left:'',right:''};if($('sortBy')){$('sortBy').stopObserving();$('perPageTop').stopObserving();}
data.left=self.render.top.left();data.right=self.render.top.right();$('pgntrHdr').update(template.evaluate(data));data.left=self.render.bottom.left();data.right=self.render.bottom.right();$('pgntrFtr').update(template.evaluate(data));$('sortBy').observe('change',istock.search.resultsHandler.observe);$('perPageTop').observe('change',istock.search.resultsHandler.observe);istock.search.displaySettings.initSettings();},hide:function(){$('pgntrHdr').update('');$('pgntrFtr').update('');}};istock.search.paginator.render.perPageOptions=function(){var self=istock.search.paginator,perPageOptions,i,options;perPageOptions=[{value:20,label:20},{value:25,label:25},{value:30,label:30},{value:50,label:50},{value:100,label:100},{value:200,label:200}];for(i=0;i<perPageOptions.length;i++){if(istock.search.preferences.get('perPage')===perPageOptions[i].value){perPageOptions[i].selected='selected="selected"';}
options+=istock.search.templates.option.evaluate(perPageOptions[i]);}
return options;};istock.search.paginator.render.bottom={left:function(){var self=istock.search.paginator,templates=istock.search.templates,template=templates.paginator.bottomLeft,data,i,dS;dS=istock.search.displaySettings.render();data={perPageLabel:translations.search.pagination.filesPerPage.label,perPageOptions:self.render.perPageOptions(),displaySettings:dS};return template.evaluate(data);},right:function(){return istock.search.paginator.render.top.right();}};istock.search.paginator.render.top={sortByOptions:[{value:istock.search.paginator._sortTypes.BY_BEST_MATCH,label:translations.search.pagination.sortBy.bestMatch},{value:istock.search.paginator._sortTypes.BY_AGE,label:translations.search.pagination.sortBy.age},{value:istock.search.paginator._sortTypes.BY_DOWNLOADS,label:translations.search.pagination.sortBy.downloads},{value:istock.search.paginator._sortTypes.BY_PHOTOGRAPHER,label:translations.search.pagination.sortBy.contributor},{value:istock.search.paginator._sortTypes.BY_SIZE,label:translations.search.pagination.sortBy.size},{value:istock.search.paginator._sortTypes.BY_TITLE,label:translations.search.pagination.sortBy.title}],left:function(){var self=istock.search.paginator,st=self._sortTypes,templates=istock.search.templates,template=templates.paginator,data,i,sortByOptions;data={sortLabel:translations.search.pagination.sortBy.label,perPageLabel:translations.search.pagination.filesPerPage.label,perPageOptions:self.render.perPageOptions(),sortByOptions:''};sortByOptions=istock.search.paginator.render.top.sortByOptions;for(i=0;i<sortByOptions.length;i++){sortByOptions[i].selected='';}
for(i=0;i<sortByOptions.length;i++){if(istock.search.preferences.get('order')===sortByOptions[i].value){sortByOptions[i].selected='selected="selected"';}
data.sortByOptions+=templates.option.evaluate(sortByOptions[i]);}
return template.topLeft.evaluate(data);},right:function(){var self=istock.search.paginator,pageJump='',template=istock.search.templates.paginator,totalPages=istock.search.resultsHandler.getTotalPages(),pages='',page='',i=0,right={},startPage=0,currentPage=istock.search.resultsHandler.getCurrentPage(),endPage=0,currentClass='',lastPageClass;if(totalPages>1){pageJump=template.pageJump.evaluate({eventClass:'e_page'});}
if(currentPage===totalPages){lastPageClass='current';}
if(totalPages<=(self.PADDING*2+1)){for(i=1;i<=totalPages;i++){if(i===currentPage){currentClass='current';}
page=template.link.evaluate({eventClass:'e_page',page:i,text:i,otherClass:currentClass});pages+=page;currentClass='';}
right={pages:pages,pageJump:pageJump,ofLabel:translations.search.pagination.ofLabel,lastButton:template.link.evaluate({eventClass:'e_page',page:totalPages,text:totalPages,otherClass:lastPageClass})};}else{startPage=currentPage-self.PADDING;endPage=currentPage+self.PADDING;while(startPage<=0){startPage++;if(endPage<totalPages){endPage++;}}
while(endPage>totalPages){endPage--;if(startPage>1){startPage--;}}
pages='';for(i=startPage;i<=endPage;i++){if(i===currentPage){currentClass='current';}
page=template.link.evaluate({eventClass:'e_page',page:i,text:i,otherClass:currentClass});pages+=page;currentClass='';}
right={pages:pages,pageJump:pageJump,ofLabel:translations.search.pagination.ofLabel,lastButton:template.link.evaluate({eventClass:'e_page',page:totalPages,text:totalPages,otherClass:lastPageClass})};}
if(currentPage>1){right.firstButton=template.button.evaluate({eventClass:'e_page',page:1,otherClass:'paginatorFirstButton'});right.prevButton=template.button.evaluate({eventClass:'e_page',page:currentPage-1,otherClass:'paginatorBackButton'});}
if(currentPage!==totalPages){right.nextButton=template.button.evaluate({eventClass:'e_page',page:currentPage+1,otherClass:'paginatorNextButton'});}else{right.nextButton=template.button.evaluate({eventClass:'e_page',page:currentPage,otherClass:'paginatorNextButton disabled'});}
return template.right.evaluate(right);}};namespacing.init('istock.widget.templates');istock.widget.templates.loupe=new Template('<div id="loupe_#{id}" class="loupe" style="width: #{image.width}px;">'+'<div class="loupePreview" id="loupePreview_#{id}">'+'<img src="#{url.thumb}" style="width:#{image.width}px; height:#{image.height}px" alt="" />'+'<img src="#{url.preview}" style="width:#{image.width}px; height:#{image.height}px; margin-top:-#{image.height}px; margin-left: -#{image.width}px;" alt="" />'+'</div>'+'#{editorialInfo}'+'<h3 class="loupeTitle"><div id="loupeSaleIcon_#{id}" class="h mr5 btm fl">#{saleIcon}</div>#{title}</h3>'+'<div id="loupeDesc_#{id}" class="loupeDescription" style="width: #{image.width}px;">Retrieving Description...</div>'+'<div class="loupeExclusive">#{exclusiveIcon}</div>'+'<div id="loupeRating_#{id}" class="loupeRating">'+'#{ratingLabel} '+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" alt="" class="ratingIcon loupeCamera0" />'+'<span class="loupeReviews" id="loupeReviews_#{id}">#{retrievingRating}</span>'+'</div>'+'</div>');namespacing.init('istock.widget');istock.widget.Loupe=Class.create({MAX_IMG_WIDTH:380,MAX_IMG_HEIGHT:380,VIDEO_PLAYER_HD:'/static/flash/new-loupe-hd.swf',VIDEO_WIDTH_HD:380,VIDEO_HEIGHT_HD:214,VIDEO_PLAYER_SD:'/static/flash/new-loupe.swf',VIDEO_WIDTH_SD:380,VIDEO_HEIGHT_SD:285,AUDIO_PLAYER:'/static/flash/audioPlayer.swf',AUDIO_WIDTH:380,AUDIO_HEIGHT:230,AUDIO_VIDEO_LOCATION:'/audio_mp3_preview.php',AUDIO_WAVEFORM_URI:'audio_passthrough.php',initialize:function(data){if(!data){throw'Loupe requires a data object to build';}else{this._data=data;}
if(!(this._container=$('srItem_'+data.id))){throw'Loupe could not find container with id:'+data.id;}
this._thumbnail=$('thumbnail_'+data.id);this._tmpl={icon:istock.search.templates.icon,loupe:istock.widget.templates.loupe,editorial:istock.search.templates.editorialInfo,saleIcon:istock.search.templates.saleIcon};},show:function(){if(this._data.type==='flash'){return;}
this._attach();this._container.showAttached();this._truncateDescription();},remove:function(){var child;if(this._container.hasAttachedChildren()){child=this._container.attachedChildren[0];if(Prototype.Browser.IE&&child.select('object').length>0){child.select('#loupePreview_'+this._data.id)[0].update('');}
istock.widget.Loupe.setOrphan(child);this._container.hideAttached();this._container.detach(child);child.remove();}},_truncateDescription:function(){var desc=$('loupeDesc_'+this._data.id);if(desc&&desc.select('.truncatedText').length<=0){desc.truncate(this._loupe.measure('width'),2);}},_attach:function(){var fn;this._loupe=this._getOrphanLoupe();if(!this._loupe){this._build();}
if(!this._container.hasAttachedChildren()){this._loupe=this._container.attach(this._loupe,{anchor:{horizontal:'right',vertical:'top'},attachee:{horizontal:'left',vertical:'top'},offset:{left:10,top:-40},viewport:{stayInside:true,stickToAnchor:{horizontal:true}}});if(this._data.flv){fn=function(){if($('loupePreview_'+this._data.id)){$('loupePreview_'+this._data.id).update(this._data.flv);}}.bind(this);fn.defer();}}},_build:function(){this._data.image=this._scaleThumbnail();this._data.ratingLabel=translations.search.metadata.rating;this._data.retrievingLabel=translations.search.metadata.retrievingRating;if(this._data.exclusivity){this._data.exclusivity=this._tmpl.icon.evaluate(this._data.exclusivity);}
if(this._data.type.indexOf('video')>=0||this._data.type==='audio'&&!this._data.flvSet){this._data.flv=this._getFlashPreview();this._data.flvSet=true;}
if(this._data.licensegroup===2){this._data.editorialInfo=this._tmpl.editorial.evaluate({editorialUseOnly:translations.search.filters.types.editorialUseOnly});}
this._data.saleIcon=this._tmpl.saleIcon.evaluate({saleIconType:'filecloseup',lang:istock.siteLang});this._loupe=this._tmpl.loupe.evaluate(this._data);this._updateMetaData();},_updateMetaData:function(){var metadata;if(!this._data.description||(this._data.type==='audio'&&!this._data.audio)){metadata=new istock.search.results.Metadata(this._data.id);metadata.request({onSuccess:function(metadata){this._setMetaData(metadata);this._populateMetaData();}.bind(this)});}else{this._popuplateMetaData();}},_populateMetaData:function(metadata){var elements;if(!(elements=this._getLoupeElements())){if(!this._timeoutId){this._timeoutId=setTimeout(function(){this._populateMetaData();this._timeoutId=null;}.bind(this),250);}
return false;}
if(this._data.sale){this._updateSaleIcon(elements.saleIconContainer);}
this._updateDescription(elements.description);this._updateRating(elements.ratingContainer);this._updateReviews(elements.reviewsContainer);this._adjustPosition();if(this._data.flv){this._updateFlashPreview(elements.thumbContainer).defer();}},_updateFlashPreview:function(container){var d=this._data,html=container.innerHTML,hasAudioPlayer=(html.indexOf(this.AUDIO_PLAYER)>=0),hasVideoPlayer=(html.indexOf(this.VIDEO_PLAYER_SD)>=0||html.indexOf(this.VIDEO_PLAYER_HD)>=0),loupeInDom=($$('body')[0].select('#loupe_'+this._data.id).length>=0);if((d.audio&&!hasAudioPlayer)||!hasVideoPlayer){if(Prototype.Browser.IE&&!loupeInDom){return;}
container.update(this._data.flv);}},_updateSaleIcon:function(container){container.removeClassName('h');},_updateDescription:function(container){container.update(this._data.description);this._truncateDescription();},_adjustPosition:function(){this._loupe.stayInViewport(this._loupe.anchorOptions.viewport);},_updateReviews:function(container){var reviewsLabel=translations.search.metadata.reviewsLabel;container.update(reviewsLabel.replace('%s',this._data.rating.RatingCount));},_updateRating:function(container){var rating,icons;if(container&&this._data.rating.RatingCount>0){rating=parseFloat(this._data.rating.RatingsAverage);icons=container.select('img');icons.each(function(icon){if(parseInt(rating,10)>0){rating--;icon.removeClassName('loupeCamera0');icon.addClassName('loupeCamera10');}else if(rating>0.0&&parseInt(rating,10)===0){rating=0;icon.removeClassName('loupeCamera0');icon.addClassName('loupeCamera5');}});}},_setMetaData:function(metadata){this._data.description=metadata.description;this._data.rating=metadata.rating;if(metadata.audio){this._data.audio=metadata.audio;this._data.flv=this._getFlashPreview();}
if(metadata.sale){this._data.sale=metadata.sale;}},_getLoupeElements:function(){var elements;try{elements=this._getActiveElements();}catch(e1){try{elements=this._getOrphanElements();}catch(e2){return false;}}
return elements;},_getOrphanLoupe:function(){return istock.widget.Loupe.getOrphan(this._data.id);},_getOrphanElements:function(){var id=this._data.id,orphan=this._getOrphanLoupe();if(orphan){return{loupe:orphan,description:orphan.select('#loupeDesc_'+id)[0],ratingContainer:orphan.select('#loupeRating_'+id)[0],reviewsContainer:orphan.select('#loupeReviews_'+id)[0],thumbContainer:orphan.select('#loupePreview_'+id)[0],saleIconContainer:orphan.select('#loupeSaleIcon_'+id)[0]};}else{throw'Orphaned loupe not found';}},_getActiveElements:function(){var id=this._data.id,loupe=$('loupe_'+id);if(loupe){return{loupe:loupe,description:$('loupeDesc_'+id),ratingContainer:$('loupeRating_'+id),reviewsContainer:$('loupeReviews_'+id),thumbContainer:$('loupePreview_'+id),saleIconContainer:$('loupeSaleIcon_'+id)};}else{throw'Active loupe not found';}},_getFlashPreview:function(){var type=this._data.type;if(type.indexOf('video')>=0){return this._getVideoFlv();}else if(type==='audio'||type==='pump-audio'){return this._getAudioFlv();}else{return'';}},_getVideoFlv:function(){var type=this._data.type,aspect,player,height,width,params,tag;aspect=type.substring(type.indexOf('-')+1);if(aspect==='169'){player=this.VIDEO_PLAYER_HD;width=this.VIDEO_WIDTH_HD;height=this.VIDEO_HEIGHT_HD;}else{player=this.VIDEO_PLAYER_SD;width=this.VIDEO_WIDTH_SD;height=this.VIDEO_HEIGHT_SD;}
params='videoLocation='+this._data.url.flv+'&ratio='+aspect;return this._buildTag(player,width,height,params);},_getAudioFlv:function(){var player=this.VIDEO_PLAYER_HD,height=this.AUDIO_HEIGHT,width=this.AUDIO_WIDTH,params='';if(this._data.audio){player=this.AUDIO_PLAYER;params='videoLocation='+this.AUDIO_VIDEO_LOCATION+'?';params+='id='+this._data.id+'&inspector=0&';params+='waveformUrl='+istock.url+this.AUDIO_WAVEFORM_URI+'?';params+='ID='+this._data.id+'%26';params+='Type=87&';params+='videoFileID='+this._data.id+'&';params+='bufferPercent=25&';params+='totalTime='+this._data.audio.totalDuration+'&';params+='bitDepth='+this._data.audio.bitDepth+'&';params+='soundField='+this._data.audio.soundField+'&';params+='tempo='+this._data.audio.tempo+'&';params+='timeSignature='+this._data.audio.timeSignature+'&';params+='showControls=0&';params+='autoPlay=1';}
return this._buildTag(player,width,height,params);},_buildTag:function(player,width,height,params){var tag;tag=new FlashTag(player,width,height);tag.setWmode('opaque');tag.bgcolor='2A3333';tag.setFlashvars(params);return tag.toString();},_scaleThumbnail:function(){var height=this._thumbnail.getHeight(),width=this._thumbnail.getWidth(),newHeight=this.MAX_IMG_HEIGHT,newWidth=this.MAX_IMG_WIDTH,ratio;if(width>height){ratio=this.MAX_IMG_WIDTH/width;newHeight=Math.ceil(height*ratio);}else if(width<height){ratio=this.MAX_IMG_HEIGHT/height;newWidth=Math.ceil(width*ratio);}
return{width:newWidth,height:newHeight};}});Object.extend(istock.widget.Loupe,{hide:function(id){try{var l=new istock.widget.Loupe({id:id});l.remove();}catch(e){if($('loupe_'+id)){$('loupe_'+id).remove();}}},hideAll:function(){$$('div.loupe').each(function(elm){var id=elm.identify().replace('loupe_','');istock.widget.Loupe.hide(id);});},setOrphan:function(loupe){istock.widget.Loupe._orphans[loupe.identify()]=loupe;},getOrphan:function(id){var self=istock.widget.Loupe,orphan;if(typeof self._orphans['loupe_'+id]==='undefined'){return false;}
return self._orphans['loupe_'+id];},_orphans:{}});namespacing.init('istock.widget');istock.widget.ColourPicker=Class.create({initialize:function(containerEl,options){if(!containerEl){throw'ColourPicker missing required Container Element.';}
if(!istock.widget.ColourPicker.isSupported()){return;}
this._options=Object.extend({classes:[],id:'',image:'/static/images/colourpicker/colourpicker.png',clearCoords:[[0,0],[14,14]]},options);this._container=containerEl;this._buildCanvas();this._setupObservers();},_buildCanvas:function(){var img=new Image();this._canvas=new Element('canvas',{id:this._options.id,className:'colourPicker '+this._options.classes.join(' ')});this._container.insert(this._canvas);this._canvas.width=parseInt(this._canvas.getStyle('width'),10);this._canvas.height=parseInt(this._canvas.getStyle('height'),10);this._context=this._canvas.getContext('2d');img.src=this._options.image;img.observe('load',function(){this._context.drawImage(img,0,0);}.bind(this));},_setupObservers:function(){this._canvas.observe('mouseover',function(){this._canvas.observe('mousemove',this._updateColour.bind(this));this._canvas.observe('click',this._colourSelected.bind(this));}.bind(this));this._canvas.observe('mouseout',function(){this._fireLastSelected();this._canvas.stopObserving('mousemove');this._canvas.stopObserving('click');}.bind(this));document.observe('colourPicker:clearSelected',function(){this._lastSelected=null;}.bind(this));document.observe('colourPicker:setLastSelected',function(evt){var exprHex=/^#?([a-f]|[A-F]|[0-9]){3}(([a-f]|[A-F]|[0-9]){3})?$/;if(evt.memo.match(exprHex)){this._lastSelected={hex:evt.memo.gsub('#','')};}}.bind(this));},_fireLastSelected:function(){var data=this._lastSelected;if(data===null){data={clear:true};}else if(typeof data==='undefined'){data={nothingSelected:true};}
this._container.fire('colourPicker:select',data);},_updateColour:function(evt,eventName){var clearCoords=this._options.clearCoords,imgData,x=evt.offsetX||evt.pageX-this._canvas.cumulativeOffset().left,y=evt.offsetY||evt.pageY-this._canvas.cumulativeOffset().top;if(!eventName){eventName='display';}
if((x>=clearCoords[0][0]&&x<=clearCoords[1][0])&&(y>=clearCoords[0][1]&&y<=clearCoords[1][1])){if(eventName==='select'&&typeof this._lastSelected!=='undefined'){this._lastSelected=null;}
this._container.fire('colourPicker:'+eventName,{clear:true});}else{try{imgData=this.getImageData(x,y);this._container.fire('colourPicker:'+eventName,imgData);if(eventName==='select'){this._lastSelected=imgData;}}catch(e){}}},_colourSelected:function(evt){this._updateColour(evt,'select');},getImageData:function(x,y){var img=this._context.getImageData(x,y,1,1),rgb=[],hex='';rgb=[img.data[0],img.data[1],img.data[2]];hex=((1<<24)|(img.data[0]<<16)|(img.data[1]<<8)|img.data[2]).toString(16).substr(1);return{rgb:rgb,hex:hex,coords:[x,y]};}});Object.extend(istock.widget.ColourPicker,{isSupported:function(){var el=new Element('canvas');return!!(el.getContext&&el.getContext('2d'));}});namespacing.init('istock.widget');istock.widget.Slicer=Class.create(Control.Slider,{initialize:function($super,handles,track,slices,options){var values=[0,slices],range=$R(0,slices,false);if(handles.length!==2){throw'Invalid number of handles, Slicer must have exactly 2 handles.';}
options=options||{};Object.extend(options,{duration:0.1,range:range,values:range.toArray(),restricted:true,sliderValue:values,onEnable:$.emptyFunction,onDisable:$.emptyFunction});this.slices=slices;this.rangeDiv=null;this._updateStackHandle=null;$super(handles,track,options);if(options.rangeDiv){this.rangeDiv=$(options.rangeDiv);}},setEnabled:function(){this.disabled=false;this._updateRangeDiv();this.options.onEnable();},setDisabled:function(){this.disabled=true;if(this.rangeDiv){this.rangeDiv.hide();}
this.options.onDisable();},_updateRangeDiv:function(){if(!this.rangeDiv){return;}
var hideRange=this.values[0]===0&&this.values[1]===this.slices,rangeTop=parseInt(this.translateToPx(this.values[0]),10),rangeHeight=parseInt(this.translateToPx(this.values[1]),10)-rangeTop;this.rangeDiv[hideRange?'hide':'show']();if(Prototype.Browser.Opera){this.rangeDiv.style.top=rangeTop+'px';this.rangeDiv.style.height=rangeHeight+'px';}else{new Effect.Morph(this.rangeDiv,{style:{top:rangeTop+'px',height:rangeHeight+'px'},duration:this.options.duration});}},updateFinished:function(){this.event=null;if(this.initialized&&this.options.onChange){this.options.onChange(this.values.slice(),this);}
this._updateRangeDiv();},startDrag:function(event){if(Event.isLeftClick(event)){if(!this.disabled){this.active=true;var handle=Event.element(event),pointer=[Event.pointerX(event),Event.pointerY(event)];track=handle,currentHandle=null,distance=null;if(track===this.track){$A(this.handles).each(function(handle,handleIdx){var offset=handle.cumulativeOffset(),handleDistance=Math.sqrt(Math.pow(offset.left-pointer[0],2)+Math.pow(offset.top-pointer[1],2));if(currentHandle===null||handleDistance<distance){currentHandle=handleIdx;distance=handleDistance;}});this.activeHandle=this.handles[currentHandle];this.activeHandleIdx=currentHandle;var offsets=this.track.cumulativeOffset();this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-offsets[1]:pointer[0]-offsets[0])-(this.handleLength/2)));if(this.isVertical()){offsets=[offsets[0],offsets[1]+parseInt(this.translateToPx(this.values[this.activeHandleIdx]),10)];}else{offsets=[offsets[0]+parseInt(this.translateToPx(this.values[this.activeHandleIdx]),10),offsets[1]];}
this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}else{while((this.handles.indexOf(handle)===-1)&&handle.parentNode){handle=handle.parentNode;}
if(this.handles.indexOf(handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var offsets=this.activeHandle.cumulativeOffset();this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}}}
Event.stop(event);}},_getNearestValueForHandle:function(sliderValue,handleIdx){if(this.allowedValues){var nearestValue=this.getNearestValue(sliderValue),minValue=this.allowedValues[0],maxValue=this.allowedValues[this.allowedValues.length-1],index,tmpSliderValue;if(handleIdx>0){tmpSliderValue=this.values[handleIdx-1];for(var index=0;index<this.allowedValues.length;++index){if(tmpSliderValue===this.allowedValues[index]&&index+1<this.allowedValues.length){minValue=this.allowedValues[index+1];break;}}}
if(handleIdx<this.handles.length-1){tmpSliderValue=this.values[handleIdx+1];for(var index=this.allowedValues.length-1;index>=0;--index){if(tmpSliderValue===this.allowedValues[index]&&index>0){maxValue=this.allowedValues[index-1];break;}}}
if(sliderValue>maxValue){sliderValue=maxValue;}else if(sliderValue<minValue){sliderValue=minValue;}
return sliderValue;}else{return sliderValue;}},selectSlice:function(slice){if(!this.allowedValues||slice<0||slice>=this.allowedValues.length||this.disabled){return;}
this._setValues([this.allowedValues[slice],this.allowedValues[slice+1]]);this.updateFinished();},extendToSlice:function(slice){if(this.disabled){return;}
var handle=1,newValues=this.values.slice();if(slice<this.values[0]){handle=0;}else if(slice>this.values[1]){handle=1;}
newValues[handle]=this.allowedValues[handle===1?slice+1:slice];this._setValues(newValues);this.updateFinished();},clearSelection:function(){this._pushUpdateStack(function(){this._setValues([this.allowedValues[0],this.allowedValues[this.allowedValues.length-1]]);}.bind(this));},populateValues:function(values){this._pushUpdateStack(function(){this._setValues(values);}.bind(this));},_pushUpdateStack:function(cb){if(this._updateStackHandle){window.clearTimeout(this._updateStackHandle);}
this._updateStackHandle=cb.defer();},_setValues:function(values){if(this.values[0]!==values[0]){this.values[0]=values[0];this._moveToValue(values[0],0);}
if(this.values[1]!==values[1]){this.values[1]=values[1];this._moveToValue(values[1],1);}
this._updateRangeDiv();},setValue:function(sliderValue,handleIdx){if(this.disabled){return;}
if(this.active&&this.allowedValues){sliderValue=this._getNearestValueForHandle(sliderValue,handleIdx||this.activeHandleIdx||0);}
if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1])){sliderValue=this.values[handleIdx-1];}
if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1])){sliderValue=this.values[handleIdx+1];}}
sliderValue=this.getNearestValue(sliderValue);if(this.values[handleIdx]!==sliderValue){this.values[handleIdx]=sliderValue;this.value=this.values[0];this._moveToValue(sliderValue,handleIdx);this.drawSpans();}
if(!this.dragging||!this.event){this.updateFinished();}else{this._updateRangeDiv();}},_moveToValue:function(sliderValue,handleIdx){var move={mode:'absolute',duration:this.options.duration};move[this.isVertical()?'y':'x']=parseInt(this.translateToPx(sliderValue),10);new Effect.Move(this.handles[handleIdx],move);}});namespacing.init('istock.search');istock.search.searchTips={show:function(e){var self=istock.search.searchTips,infotipContainer;if(self.isOpen()){return;}
self._searchTip=new istock.Infotip({title:translations.search.searchTips.title,anchor:e.element(),contents:translations.search.searchTips.info,customClass:'searchTipsInfoTip',attachOptions:{anchor:{horizontal:'right',vertical:'top',ignore:'margin'},attachee:{horizontal:'left',vertical:'top'}}});istock.Infotip.addToRegistry(self._searchTip);self._searchTip.show();infotipContainer=$$('.infotipContainer')[0];infotipContainer.observe('mouseover',function(){self._searchTip._clearTimeout();});infotipContainer.observe('mouseout',function(){self._searchTip._setTimeout(0);});e.element().observe('mouseout',function(){self._searchTip._setTimeout(2000);});e.element().observe('mouseover',function(){self._searchTip._clearTimeout();});},isOpen:function(){var self=istock.search.searchTips;if($$('.e_searchTips')[0].hasAttachedChildren()&&$$('.e_searchTips')[0].attachedChildren[0].visible()){return true;}
return false;}};Event.observe(document,'search:loaded',function(){var searchTips=istock.search.searchTips,searchTipImg;searchTipImg=$$('.e_searchTips');if(searchTipImg.length>0){searchTipImg[0].observe('mouseover',searchTips.show);}});namespacing.init('istock.search');istock.search.editorialTips={_closeTimeoutId:null,show:function(e){var self=istock.search.editorialTips,infotipContainer;self._editorialTip=new istock.Infotip({id:'editorialInfoTip',title:'',anchor:e.element(),contents:'<img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="icons editorial" />'+translations.search.editorialTips.info,attachOptions:{anchor:{horizontal:'right',vertical:'top',ignore:'margin'},attachee:{horizontal:'left',vertical:'top'}}});self._editorialTip.show();infotipContainer=$('editorialInfoTip');infotipContainer.observe('mouseover',function(){self._editorialTip._clearTimeout();});infotipContainer.observe('mouseout',function(){self._editorialTip._setTimeout(0);});e.element().observe('mouseout',function(){self._editorialTip._setTimeout(2000);});e.element().observe('mouseover',function(){self._editorialTip._clearTimeout();});}};Event.observe(document,'search:loaded',function(){var editorialTips=istock.search.editorialTips,editorialTipImg;editorialTipImg=$$('.e_editorialTips');if(editorialTipImg.length>0){editorialTipImg[0].observe('mouseover',editorialTips.show);}});namespacing.init('istock.search');istock.search.displaySettings={CONTRIBUTOR:'srContributor',DOWNLOADS:'srDownload',FILE_NUMBER:'srFileNumber',LOUPE:'srLoupe',TITLE:'srTitle',ADULT_CONTENT:'srAdultContent',ALWAYS_EXCLUDE_EDITORIAL:'srAlwaysExcludeEditorial',_timeoutId:null,_isInitialized:false,render:function(){var self=istock.search.displaySettings,t=translations.search,template=istock.search.templates.displaySettings,prefs=istock.search.preferences,chkd='checked="checked"',i,data={displaySettingsLabel:t.displaySettings.title,fileDetailsTitle:t.displaySettings.fileDetails.title,title:{label:t.displaySettings.fileDetails.titles,checked:(prefs.get('showTitle')?chkd:'')},contributor:{label:t.displaySettings.fileDetails.contributor,checked:(prefs.get('showContributor')?chkd:'')},fileNumber:{label:t.displaySettings.fileDetails.fileNumber,checked:(prefs.get('showFileNumber')?chkd:'')},downloads:{label:t.displaySettings.fileDetails.downloads,checked:(prefs.get('showDownload')?chkd:'')},loupe:{label:t.displaySettings.fileDetails.loupe,checked:(prefs.get('enableLoupe')?chkd:'')},adultContent:{title:t.displaySettings.adultContent.title,label:t.displaySettings.adultContent.checkbox,checked:(prefs.get('filterContent')?'':chkd)},alwaysExcludeEditorial:{title:t.displaySettings.alwaysExcludeEditorial.title,label:t.displaySettings.alwaysExcludeEditorial.checkbox,checked:(prefs.get('alwaysExcludeEditorial')?chkd:'')}};data.editorialDisplaySettings=istock.search.templates.editorialDisplaySettings.evaluate(data);return template.evaluate(data);},isVisible:function(){if($('displaySettingsSelector')&&$('displaySettingsSelector').visible()){return true;}
return false;},hide:function(){if(istock.search.displaySettings.isVisible()){efCntrlr.forceClose();}},setMeta:function(meta,display){var self=istock.search.displaySettings,prefs=istock.search.preferences;if(meta===self.ADULT_CONTENT){display=!display;}
meta=self._changeDisplaySetting(meta,display);prefs.set(meta,display);},setAlwaysExcludeEditorial:function(meta,display){var self=istock.search.displaySettings,prefs=istock.search.preferences,event;meta=self._changeDisplaySetting(meta,display);prefs.set(meta,display);if(!display){return;}
istock.search.event.fire(istock.search.event.REMOVE_FACET,new istock.search.Facet(istock.search.facetTypes.LICENSE_GROUP,'1','Creative'));istock.search.event.fire(istock.search.event.ADD_FACET,new istock.search.Facet(istock.search.facetTypes.LICENSE_GROUP,'0','Creative'));},setAdultContent:function(){var self=istock.search.displaySettings,event;istock.search.event.fire(istock.search.event.ADD_FACET,istock.search.Facet.factory(istock.search.facetTypes.RESTRICT_ADULT_CONTENT,!$('displaySettingsAdultContent').checked,''));},initSettings:function(settings){var self=istock.search.displaySettings,ms;$('displaySettingsAdultContent').observe('click',function(){self.setAdultContent();});self._isInitialized=true;self._toggleAllMeta();ms=new istock.widget.MenuSelector($('displaySettingsContainer'));},_changeDisplaySetting:function(meta,display){var self=istock.search.displaySettings;if(meta===self.LOUPE){$$('.srFile img').invoke((display?'add':'remove')+'ClassName','e_loupe');meta=meta.replace('sr','enable');}else if(meta===self.ADULT_CONTENT){meta='filterContent';}else if(meta===self.ALWAYS_EXCLUDE_EDITORIAL){meta='alwaysExcludeEditorial';}else{$$('.srItem .'+meta).invoke(display?'show':'hide');meta=meta.replace('sr','show');}
return meta;},_toggleAllMeta:function(){var prefs=istock.search.preferences,self=istock.search.displaySettings;if(!prefs||!self._isInitialized){return;}
if(prefs.get('showContributor')){$('displaySettingsContributor').defaultChecked=true;}else{self._changeDisplaySetting(self.CONTRIBUTOR,false);}
if(prefs.get('showDownload')){$('displaySettingsDownloads').defaultChecked=true;}else{self._changeDisplaySetting(self.DOWNLOADS,false);}
if(prefs.get('showFileNumber')){$('displaySettingsFileNum').defaultChecked=true;}else{self._changeDisplaySetting(self.FILE_NUMBER,false);}
if(prefs.get('showTitle')){$('displaySettingsTitles').defaultChecked=true;}else{self._changeDisplaySetting(self.TITLE,false);}
if(prefs.get('enableLoupe')){$('displaySettingsLoupe').defaultChecked=true;}else{self._changeDisplaySetting(self.LOUPE,false);}
if(!prefs.get('filterContent')||prefs.get('filterContent')=="0"){$('displaySettingsAdultContent').defaultChecked=true;}}};namespacing.init('istock.search.results');istock.search.results.Item=Class.create({VP_OFFSET:440,MAIN:1,EDITORIAL:2,initialize:function(data){this._tmpl={item:istock.search.templates.searchResult,icon:istock.search.templates.icon,image:istock.search.templates.imageLink,sale:istock.search.templates.saleIcon,cart:istock.search.templates.cartIcon};this._data=data;this._data.downloadCount=data.realdownloadcount||data.downloads;this._classes=[];},loadImage:function(){var img=$('thumbnail_'+this._data.id);if(img&&img.src!==this._data.url.thumb&&img.isInViewport({top:this.VP_OFFSET})){img.src=this._data.url.thumb;this._data.url.thumbLoaded=true;return true;}
return false;},toHTML:function(){this._build();return this._html;},_build:function(){if(!this._data){this._html='';return;}
this._buildAddToCartIcon();this._buildExclusiveIcon();this._buildFileTypeIcon();this._buildEditorialIcon();this._buildLightboxIcon();this._buildSaleIcon();this._buildFlamesIcon();this._buildOtherClass();this._data.searchToken=istock.search.resultsHandler.getSearchToken().substr(0,7);if(Prototype.Browser.IE||Prototype.Browser.Opera){this._data.url.thumbnail=this._data.url.thumb;this._data.url.thumbLoaded=true;}else if(this._data.type==='audio'){this._data.url.thumbnail=istock.cookielessUrl+'/static/images/audioThumb.jpg';this._data.url.thumbLoaded=true;}else{this._data.url.thumbnail=istock.cookielessUrl+'/static/images/blank.gif';}
this._html=this._tmpl.item.evaluate(this._data);},_buildOtherClass:function(){if(this._classes.length>0){this._data.otherClass=this._classes.join(' ');}},_buildFileTypeIcon:function(){var type=this._data.type,collection=this._data.collection,icon=type,title=icon.capitalize(),image;if(type.indexOf('-')>=0){type=type.substring(0,type.indexOf('-'));}
if(this.is().agency||this.is().pump||this.is().vetta){icon=collection;title=collection.capitalize();if(this.is().vetta){icon+=type.capitalize();title+='&reg; '+type;}}
title=translations.search.results.icons.type[title]||title;image=this._tmpl.icon.evaluate({icon:icon,title:title});this._data.fileTypeIcon=this._tmpl.image.evaluate({url:'/icons.php',target:'target="icons"',icon:image});},_buildEditorialIcon:function(){var icon,image;if(this._data.licensegroup===this.EDITORIAL){this._addOtherClass('editorial');image=this._tmpl.icon.evaluate({icon:'editorial',title:translations.search.results.icons.editorial});this._data.editorialIcon=this._tmpl.image.evaluate({url:'/icons.php',target:'target="icons"',icon:image});}},_buildLightboxIcon:function(){var lb=istock.search.lightbox;if(istock.loggedin){if(!((lb.flags&&lb.flags.isLightbox)&&(lb.flags.isAdmin||lb.flags.isOwner))){this._data.lightboxIcon='<a href="javascript:void(0);" class="addToLightboxTrigger" data-file-id="'+this._data.id+'">'+this._tmpl.icon.evaluate({icon:'lbAdd cp fr',title:translations.search.results.addToLightbox,url:'#'})+'</a>';}else if((lb.flags&&lb.flags.isLightbox)&&(lb.flags.isAdmin||lb.flags.isOwner)){this._data.lightboxIcon=this._tmpl.icon.evaluate({icon:'e_lightboxRemoveFile '+this._data.id+' lbDel cp fr',title:translations.search.results.removeFromLightbox,url:'#'});}}},_buildAddToCartIcon:function(){this._data.addToCartIcon=this._tmpl.cart.evaluate({id:this._data.id,icon:'cartAdd cp fr',title:translations.search.results.addToCart,url:'#'});},_buildFlamesIcon:function(result){var downloadCount=0,image;this._data.flamesIcon='';if(!Object.isUndefined(this._data.downloads)){downloadCount=parseInt(this._data.downloads.sub('> ',''),10);if(downloadCount>=100){image=this._tmpl.icon.evaluate({icon:'flames'+downloadCount,title:'More than '+downloadCount+' downloads'});this._data.flamesIcon=image;}}},_buildSaleIcon:function(){if(this._data.onSale){this._data.saleIcon=this._tmpl.sale.evaluate({saleIconType:'search',lang:istock.siteLang});}},_buildExclusiveIcon:function(){var icon=this._data.type,iconClass='',image,title='';if(icon.indexOf('-')>=0){icon=icon.substring(0,icon.indexOf('-'));}
if(this.is().exclusive||this.is().exclusivePlus||this.is().plus){title=this._data.collection.capitalize();}else if(this._data.contributor&&this._data.contributor.exclusive){title='Exclusive';}
if(!title.blank()){iconClass=icon+title.gsub('+','Plus');title=translations.search.results.icons.exclusive[title]||title;image=this._tmpl.icon.evaluate({icon:iconClass,title:title});this._data.exclusiveIcon=this._tmpl.image.evaluate({url:'/icons.php',target:'target="icons"',icon:image});}},is:function(){var _collection=function(type){return this._data.collection&&this._data.collection.toLowerCase()===type.toLowerCase();}.bind(this);return{agency:_collection('agency'),vetta:_collection('vetta'),exclusive:_collection('exclusive'),exclusivePlus:_collection('exclusive+'),plus:_collection('plus'),pump:_collection('pump')};},_addOtherClass:function(cls){this._classes.push(cls);}});Object.extend(istock.search.results.Item,{loadImages:function(){var load=function(){this._loadImages();}.bind(this);if(this._timeoutId){clearTimeout(this._timeoutId);this._timeoutId=null;}
this._timeoutId=setTimeout(load,125);},_loadImages:function(){var i,items=this._thumbs,count=items.length,item,itemObj;if(count<=0){return;}
for(i=0;i<items.length;i++){item=items[i];if(!item.url.thumbLoaded){itemObj=new istock.search.results.Item(item);if(itemObj.loadImage()){this._thumbs=this._thumbs.without(item);}}}
document.fire(istock.search.event.RESULTS_RENDERED);},initImageQueue:function(newResultsObj){var i=0,results,count;if(!(results=newResultsObj.results)){this._thumbs=[];return;}
for(i=0,count=results.length;i<count;i++){if(!results[i].url.thumbLoaded){this._thumbs.push(results[i]);}}},_thumbs:[],_timeoutId:null});document.observe('search:loaded',function(){var itemObj=istock.search.results.Item;if(!(Prototype.Browser.IE||Prototype.Browser.Opera)){document.observe('scroll',itemObj.loadImages.bind(itemObj));Event.observe(window,'resize',itemObj.loadImages.bind(itemObj));}
document.observe(istock.search.event.NEW_RESULTS,function(evt){itemObj.initImageQueue(evt.memo);}.bind(itemObj));});namespacing.init('istock.search.results');istock.search.results.Row=Class.create({initialize:function(data){this._data=data;this._data.downloadCount=data.realdownloadcount||data.downloads;this._tmpl={row:istock.search.templates.audio.row,icon:istock.search.templates.icon,cart:istock.search.templates.cartIcon,data:{contributor:{username:'&nbsp;'},downloads:'&lt; 100',audio:{title:'&nbsp;',genre:'&nbsp;',key:'&nbsp;',duration:'&nbsp;'}}};this._classes=[];this._listPlayer=new istock.search.ListPlayer({id:data.id,duration:data.audio.duration});},addClass:function(cls){this._classes.push(cls);},toHTML:function(){this._build();return this._html;},_build:function(){this._updateTemplateData();this._buildLightboxIcon();this._buildAddToCartIcon();this._setAudioIcon();this._beautifyDuration();this._addExtraClasses();this._data.searchToken=istock.search.resultsHandler.getSearchToken().substr(0,7);this._html=this._tmpl.row.evaluate(this._data);},_updateTemplateData:function(){this._data.ratingLabel=translations.search.metadata.rating+':';this._data.retrievingRating=translations.search.metadata.retrievingRating;},_buildLightboxIcon:function(){var lb=istock.search.lightbox;if(istock.loggedin){if(!((lb.flags&&lb.flags.isLightbox)&&(lb.flags.isAdmin||lb.flags.isOwner))){this._data.lightboxIcon='<a href="javascript:void(0);" class="addToLightboxTrigger" data-file-id="'+this._data.id+'">'+this._tmpl.icon.evaluate({icon:'lbAdd cp fr',title:translations.search.results.addToLightbox,url:'#'})+'</a>';}else if((lb.flags&&lb.flags.isLightbox)&&(lb.flags.isAdmin||lb.flags.isOwner)){this._data.lightboxIcon=this._tmpl.icon.evaluate({icon:'e_lightboxRemoveFile '+this._data.id+' lbDel cp',title:translations.search.results.removeFromLightbox,url:'#'});}}},_buildAddToCartIcon:function(){this._data.addToCartIcon=this._tmpl.cart.evaluate({id:this._data.id,icon:'cartAdd cp',title:translations.search.results.addToCart,url:'#'});},_setAudioIcon:function(){if(this._data.collection&&this._data.collection==='pump'){this._data.audioIcon='pump';}else{this._data.audioIcon='audio';}},_beautifyDuration:function(){var duration=this._data.audio.duration,time,minutes,seconds,milliseconds,pad=function(number,length){var str=number.toString();while(str.length<length){str='0'+str;}
return str;};if(!isNaN(duration)){time=new Date(duration*1000);minutes=time.getUTCMinutes();seconds=time.getUTCSeconds();duration=duration.toString();milliseconds=duration.indexOf('.')>=0?'.'+Math.ceil(duration.substring(duration.indexOf('.'))*10):'';if(parseInt(milliseconds.substring(1),10)>=10){seconds++;if(seconds>=60){seconds=0;minutes++;}
milliseconds='';}
this._data.audio.duration=pad(minutes,2)+':'+pad(seconds,2)+milliseconds;}},_addExtraClasses:function(){if(this._classes.length>0){this._data.extraClass=this._classes.join(' ');}}});namespacing.init('istock.search.results.');istock.search.results.Metadata=Class.create({initialize:function(id){if(!id){throw'Metadata object requires an ID';}
this._id=id;this._data=null;},request:function(options){var ajx=new Ajax.Request('/json/metadata/abstractFileId/'+this._id,{method:'post',onSuccess:function(r){var json=r.responseText.evalJSON();json.data.id=this._id;this._data=json.data;if(json.status==="1"){if(typeof options.onSuccess!=='undefined'){options.onSuccess(json.data);}}}.bind(this)});}});namespacing.init('istock.search');istock.search.resultsHandler={_resultData:null,_keyIsDown:false,_isNewPage:false,getTotalPages:function(){return(Math.ceil(this.getTotalResultCount()/this.getItemsPerPage()))||0;},getCurrentTimestamp:function(){return this._getData('timestamp')||false;},getCurrentPage:function(){return this._getData('page')||1;},getSearchToken:function(){return this._getData('searchToken')||'default';},getTotalResultCount:function(){return this._getData('totalResultCount')||0;},getIsHistoryLoad:function(){return this._getData('isHistoryLoad')||false;},getUserSegmentId:function(){return this._getData('segmentId')||'Default';},adjustTotalResultCount:function(num){if(!this._resultData){return;}
this._resultData.totalResultCount=this.getTotalResultCount()+num;istock.search.event.fire(istock.search.event.UPDATE_TITLE,{count:istock.search.resultsHandler.getTotalResultCount()});},getItemsPerPage:function(){var perPage=istock.search.preferences.get('perPage');if(perPage<20){return 50;}
return perPage;},getResultSet:function(displayOnly){var self=istock.search.resultsHandler,results;if((results=self._getData('results'))){results=results.clone();if(displayOnly){results=results.splice(0,self.getItemsPerPage());}
return results;}
return[];},getResultMeta:function(id){var self=istock.search.resultsHandler,results=self._resultData.results,i;for(i=0;i<results.length;i++){if(results[i].id===id){return results[i];}}
return false;},setResultMeta:function(id,key,value){var self=istock.search.resultsHandler,results=self._resultData.results,i;for(i=0;i<results.length;i++){if(results[i].id===id){results[i][key]=value;return results[i];}}
return false;},resizeContainer:function(size){$('srchCntr').setStyle({'height':size+'px'});},render:function(data){this._resultData=data;this.crear();if(('errorCode'in data&&data.errorCode!==0)||!'results'in data||data.results.size()<=0){this.renderZeroResults();return;}
if('audioOnly'in data&&data.audioOnly){this.renderListView();return;}
this.renderThumbnails();},renderThumbnails:function(){var arrResults,result,resultItem,html='',item;if(!(arrResults=this.getResultSet()).size()){return false;}
for(item=0;item<this.getItemsPerPage();item++){result=arrResults[item];if(!result){continue;}
html+=(new istock.search.results.Item(result)).toHTML();}
this._updateSearchResults(html);this.updateLastRow();(function(){if(!Prototype.Browser.IE||Prototype.Browser.Version[0]>=8){istock.search.results.Item.loadImages(arrResults);}}).defer();},renderListView:function(){var resultsContainer=istock.search.templates.audio.container,details={heading:{title:translations.search.audioList.title,genre:translations.search.audioList.genre,contributor:translations.search.audioList.contributor,tempo:translations.search.audioList.tempo,key:translations.search.audioList.key,duration:translations.search.audioList.duration,downloads:translations.search.audioList.downloads},rows:''};this.getResultSet(true).each(function(result){details.rows+=(new istock.search.results.Row(result)).toHTML();});this._updateSearchResults(resultsContainer.evaluate(details));},renderZeroResults:function(){$('srchRslts').insert((new istock.search.ZeroResults(this._getData('errorCode'))).render());if($('lightboxTools')){$('lightboxTools').hide();}
istock.search.GettyLinks.hide();istock.search.paginator.hide();this._resultData=null;},updateLastRow:function(){this._addNext();this._addLastRowClass();this._addClearDiv();},crear:function(){istock.widget.Loupe.hideAll();$('srchRslts').update('');},_updateSearchResults:function(html){$('srchRslts').insert(html);if($('lightboxTools')){$('lightboxTools').show();}
istock.search.paginator.render();istock.search.GettyLinks.show();document.fire(istock.search.event.RESULTS_RENDERED);},_getData:function(prop){if(!this._resultData||!prop in this._resultData){return null;}
return this._resultData[prop];},_addNext:function(){var resultItem;$$('.srItem.preview').invoke('remove');if(this.getCurrentPage()!==this.getTotalPages()&&!this._getData('audioOnly')&&this.getResultSet().size())
{resultItem=istock.search.templates.nextResultSetButton.evaluate({eventClass:'e_page',page:this.getCurrentPage()+1});$('srchRslts').insert(resultItem);}},_addClearDiv:function(){var results=$('srchRslts'),clear=new Element('div',{'class':'clear'});results.select('> div.clear').invoke('remove');results.insert({bottom:clear});},_getItemsPerRow:function(){var container=$('srchRslts'),dim={innerWidth:0,itemWidth:0},searchResult=$$('.srItem:not(.preview)')[0];if(!searchResult){return;}
dim.innerWidth=container.getLayout().get('padding-box-width');dim.itemWidth=searchResult.getLayout().get('margin-box-width');return Math.floor(dim.innerWidth/dim.itemWidth);},_addLastRowClass:function(){var self=istock.search.resultsHandler,itemsPerRow=self._getItemsPerRow(),items=$$('.srItem'),numItemsOnLastRow=items.length%itemsPerRow,i;items.invoke('removeClassName','lastRow');numItemsOnLastRow=numItemsOnLastRow===0?itemsPerRow:numItemsOnLastRow;for(i=items.length-1;i>items.length-numItemsOnLastRow-1;i--){if(!items[i]){continue;}
items[i].addClassName('lastRow');}},observe:function(e){var classes=$w(e.element().className),self=istock.search.resultsHandler,p,index=0;if(e.type==='keydown'&&(e.keyCode===Event.KEY_LEFT||e.keyCode===Event.KEY_RIGHT)&&(e.element().type!=='text')&&!(self._keyIsDown)){p=self.getCurrentPage();if(e.keyCode===Event.KEY_LEFT){p--;}else{p++;}
classes=['e_page','pg'+p];self._keyIsDown=true;}
if(e.type==='keyup'&&self._keyIsDown){self._keyIsDown=false;}
if(classes[0]&&(classes[0].startsWith('e_')||(index=classes.indexOf('e_loupe')))){self.cls=classes[index];switch(self.cls){case'e_loupe':if(e.type!=='mouseover'&&e.type!=='mouseout'){return;}
(function(){var id=parseInt(e.element().identify().replace('thumbnail_',''),10),item,result,loupe;if(e.type==='mouseover'){for(item=0;item<self._resultData.results.length;item++){result=self._resultData.results[item];if(result.id===id){loupe=new istock.widget.Loupe(result);loupe.show();}}}else if(e.type==='mouseout'){istock.widget.Loupe.hide(id);}})();break;case'e_page':(function(e){var page;if((e.type==='click'||e.type==='keydown')&&e.element().type!=='text'){page=parseInt(classes[1].replace('pg',''),10);}else if(e.type==='keypress'&&e.element().type==='text'&&e.keyCode===Event.KEY_RETURN){page=parseInt(e.element().value,10);if(isNaN(page)){e.stop();return;}}else if(e.type==='keypress'&&e.element().type==='text'&&((e.charCode<48||e.charCode>57)&&e.keyCode!==Event.KEY_BACKSPACE&&e.keyCode!==Event.KEY_DELETE&&e.keyCode!==Event.KEY_LEFT&&(e.keyCode!==Event.KEY_RIGHT))){e.stop();return false;}else{return;}
e.stop();if(!self.getResultSet().size()){return;}
if(page<1){page=1;}else if(page>self.getTotalPages()){page=self.getTotalPages();}
if(page===self.getCurrentPage()){e.stop();return;}
istock.search.event.fire(istock.search.event.NEW_PAGE,new istock.search.Facet(istock.search.facetTypes.PAGE_NUMBER,page,'Page Number'));self._isNewPage=true;})(e);break;case'e_filesPerPage':if(e.type!=='change'){return;}
(function(e){var filesPerPage,list;list=e.element();filesPerPage=parseInt(list.value,10);if(self.lastPerPage&&self.lastPerPage===filesPerPage){return;}
self.lastPerPage=filesPerPage;$$('.e_filesPerPage').each(function(fpp){if(parseInt(fpp.value,10)!==filesPerPage){fpp.select('option[value="'+filesPerPage+'"]')[0].selected=true;}});istock.search.preferences.set('perPage',filesPerPage);istock.search.event.fire(istock.search.event.ADD_FACET,new istock.search.Facet(istock.search.facetTypes.PER_PAGE,filesPerPage,'Files per page'));})(e);break;case'e_sortBy':if(e.type!=='change'){return;}
(function(){var sortBy,list;list=e.element();sortBy=parseInt(list.value,10);istock.search.preferences.set('order',sortBy);istock.search.event.fire(istock.search.event.ADD_FACET,new istock.search.Facet(istock.search.facetTypes.RESULT_ORDER,sortBy,list.select('option[value="'+sortBy+'"]')[0].innerHTML));})();break;case'e_dispSetting':if(e.type!=='click'){return;}
if(classes[1]==='srAlwaysExcludeEditorial'){istock.search.displaySettings.setAlwaysExcludeEditorial(classes[1],e.element().checked);}else{istock.search.displaySettings.setMeta(classes[1],e.element().checked);}
document.fire(istock.search.event.RESULTS_RENDERED);break;case'e_listPlayer':if(e.type!=='click'){return;}
(function(classes){var action=classes[2],toggle=parseInt(classes[3],10),id=parseInt(classes[4],10);if(action==='playAudio'){istock.search.listPlayers.play(id,toggle);}else{istock.search.listPlayers.pause(id,toggle);}})(classes);break;default:break;}}}};Event.observe(document,'search:loaded',function(){var rH=istock.search.resultsHandler,timeoutId;Event.observe(document,'click',rH.observe);Event.observe(document,'mouseover',rH.observe);Event.observe(document,'mouseout',rH.observe);Event.observe(document,'keypress',rH.observe);Event.observe(document,'keydown',rH.observe);Event.observe(document,'keyup',rH.observe);Event.observe(document,istock.search.event.NEW_RESULTS,function(event){var rH=istock.search.resultsHandler,data=event.memo;if(!$$('nav')[0].isInViewport()&&rH._isNewPage){$$('header')[0].scrollTo();rH._isNewPage=false;}
rH.crear();rH.render(data);if(istock.loggedin){istock.search.email.OptInLink.show();}else{istock.search.email.OptInLink.hide();}});Event.observe(window,'resize',function(){if(timeoutId){clearTimeout(timeoutId);timeoutId=null;}
if(rH.getResultSet().size()){timeoutId=setTimeout(rH.updateLastRow.bind(rH),100);}});});Event.observe(window,'unload',function(){istock.widget.Loupe.hideAll();});namespacing.init('istock.search');istock.search.History=Class.create(istock.History,{_initialLoad:true,initialize:function($super){$super();this._facetStack=new istock.search.FacetStack();this.setHandler(function(state){this.loadSearchState(state);}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){this._facetStack.addFacet(event.memo.facet);}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){this._facetStack.removeFacet(event.memo.facet);}.bind(this));Event.observe(document,istock.search.event.NEW_PAGE,function(event){this._facetStack.addFacet(event.memo.facet);}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){this.process(event.memo);}.bind(this));},process:function(results){var state;if(this._isNotHistoryLoad(results)&&istock.sessionStorage){state=this._encodeState(this._facetStack);if(istock.search.History.getHash().blank()&&istock.sessionStorage.getItem('initialState')!==state){istock.sessionStorage.setItem('initialState',state);}
this._saveState(state,[results,this._facetStack]);}},loadSearchState:function(state){try{var sessionVal=null,results=null,facetStack=null,saveFound=false,title={};if(state===''){state=istock.sessionStorage.getItem('initialState');}
sessionVal=this._sessionGet(state);results=sessionVal&&sessionVal[0];facetStack=new istock.search.FacetStack().parse(sessionVal&&sessionVal[1]);saveFound=this._loadSavedSearch(results);this._updateFacetsContainer(facetStack,saveFound);if(saveFound){if(results.title){title.caption=results.title;}
title.count=results.totalResultCount;istock.search.event.fire(istock.search.event.UPDATE_TITLE,title).defer();}}catch(e){}},_saveState:function(state,data){this.setState(state);this.setHash(state);try{istock.sessionStorage.setItem(state,Object.toJSON(data));}catch(e){}},_loadSavedSearch:function(savedSearch){if(savedSearch!==null){savedSearch.isHistoryLoad=true;istock.search.Handler.fireNewResultEvents(savedSearch);return true;}
return false;},_sessionGet:function(key){try{return istock.sessionStorage.getItem(key).evalJSON(true);}catch(e){return null;}},_isNotHistoryLoad:function(results){return(Object.isUndefined(results.isHistoryLoad)||results.isHistoryLoad!==true);},_encodeState:function(facetStack){return istock.calc.crc32(Object.toJSON(facetStack));},_updateFacetsContainer:function(newFacets,isRenderOnly){this._fireEvents(istock.search.event.REMOVE_FACET,this._facetStack,isRenderOnly);this._fireEvents(istock.search.event.ADD_FACET,newFacets,isRenderOnly);},_fireEvents:function(action,facetStack,isRenderOnly){facetStack.filters().each(function(filter){filter.facets.each(function(facet){istock.search.event.fire(action,facet,isRenderOnly);});});},_facetStack:{},_initialState:''});Object.extend(istock.search.History,{_historyObj:null,getHash:function(){return this._history().getHash();},setState:function(state){return this._history().setState(state);},loadSearchState:function(state){this._history().loadSearchState(state);},isStateValid:function(state){try{return!!this._history()._sessionGet(state);}catch(e){return false;}},_history:function(){this.initialize();return this._historyObj;},initialize:function(){if(this._historyObj===null){this._historyObj=new istock.search.History();}}});Event.observe(document,'search:loaded',function(){istock.search.History.initialize();});namespacing.init('istock.search.filters');istock.search.filters.FileType=Class.create({TYPES:{'PHOTO':1,'ILLUSTRATION':7,'VIDEO':8,'AUDIO':9,'FLASH':4},initialize:function(){var objListener=new istock.search.FacetListener($$('#filetype_filter input[type="checkbox"]'),istock.search.facetTypes.FILE_TYPE);}});Object.extend(istock.search.filters.FileType,{numFileTypes:function(){return Object.values(this.prototype.TYPES).size();},getTypes:function(){return this.prototype.TYPES;}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.FileType();});namespacing.init('istock.search.filters');istock.search.filters.LicenseGroup=Class.create({initialize:function(){var obj=new istock.search.FacetListener($$('#licenseGroup_list input[type="checkbox"]'),istock.search.facetTypes.LICENSE_GROUP);}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.LicenseGroup();});namespacing.init('istock.search.filters');istock.search.filters.Keyword=Class.create({DEFAULT_KEYWORD_TEXT:translations.search.filters.keywords.add,MODIFIER_DOM_ID:'keyword_facet_modifier',initialize:function(){var hintObj;$('keyword_submit').observe('click',function(e){this._addKeyword();}.bind(this));$('keyword_input').observe('click',function(e){if(this._keyword().value===this.DEFAULT_KEYWORD_TEXT){this._keyword().value='';}}.bind(this));$('keyword_input').observe('blur',function(e){if(this._keyword().value.blank()){this._keyword().value=this.DEFAULT_KEYWORD_TEXT;}}.bind(this));$('keyword_input').observe('keypress',function(e){if(e.keyCode===Event.KEY_RETURN){this._addKeyword();$('keyword_input').value='';hintObj.ignoreResponse=true;}}.bind(this));hintObj=new Autocomplete('keyword_input',{maxSuggestions:7,maxMembernames:0,width:246+11,serviceUrl:'/json/hints',onSelect:function(value,data){if(data.disambiguation){this._disambiguation.term=data.disambiguation.string;this._disambiguation.termId=data.disambiguation.termId;}}.bind(this)});},_addKeyword:function(){if(this._isValidKeyword()){this._fireAddEvent(this._constructKeyword());}else{return;}
if(this._isDisambiguated()){istock.search.event.fire(istock.search.event.ADD_FACET,istock.search.Facet.factory(istock.search.facetTypes.DISAMBIGUATION,[this._disambiguation.termId],this._constructKeyword()));this._clearDisambiguation();}},_isValidKeyword:function(){var keyword=this._cleanCommas(this._keyword().value);return(!keyword.blank()&&keyword!==this.DEFAULT_KEYWORD_TEXT);},_fireAddEvent:function(keyword){istock.search.event.fire(istock.search.event.ADD_FACET,new istock.search.facet.Keyword(keyword,keyword));this._keyword().value=this.DEFAULT_KEYWORD_TEXT;},_isDisambiguated:function(){return(!!this._disambiguation.termId);},_clearDisambiguation:function(){this._disambiguation={term:null,termId:null};},_keyword:function(){return $('keyword_input');},_constructKeyword:function(){return this._modifier()+'('+(this._disambiguation.term||this._cleanCommas(this._keyword().value))+')';},_cleanCommas:function(keywords){var sanitizedWords='';keywords=keywords.split(',');keywords.each(function(word){word=word.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(!word.blank()){sanitizedWords+=word+', ';}});return sanitizedWords.truncate(sanitizedWords.length-2,'');},_modifier:function(){if(this._isModifierViewable()){return $$('#'+this.MODIFIER_DOM_ID+' input[type="radio"]').find(function(radio){return radio.checked;}).value+' ';}
return $('modifier_AND').value+' ';},_isModifierViewable:function()
{return $(this.MODIFIER_DOM_ID).visible();},_disambiguation:{term:null,termId:null}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Keyword();});namespacing.init('istock.search.filters');istock.search.filters.PhotoIllustration=Class.create({ORIENTATION_TYPES:{'HORIZONTAL':4,'VERTICAL':1,'SQUARE':2},DEFAULT_COLOUR_LABEL:'HEX',initialize:function(){var obj=new istock.search.FacetListener($$('#orientation_list input[type="checkbox"]'),istock.search.facetTypes.ORIENTATION,this._fireEventOrientation.bind(this));obj=new istock.search.FacetListener($$('#largePhoto_list input[type="checkbox"]'),istock.search.facetTypes.PHOTO_SIZE);obj=new istock.search.FacetListener($$('#illustrationPrice_list input[type="checkbox"]'),istock.search.facetTypes.ILLUSTRATION_PRICE);this._setupCopySpace();this._setupColourPicker();},_setupColourPicker:function(){var container=$('colourSelector'),colourPicker=new istock.widget.ColourPicker(container,{id:'colourPickerBar'});container.select('a')[0].observe('click',function(evt){var hex=container.select('input')[0].value,exprHex=/^#?([a-f]|[A-F]|[0-9]){3}(([a-f]|[A-F]|[0-9]){3})?$/;evt.stop();if(hex.match(exprHex)!==null){this._addColourFacet(hex.gsub('#',''));}else if(hex===''||hex===this.DEFAULT_COLOUR_LABEL){this._removeColourFacet();}}.bind(this));this._setupColourPreview();this._previousColour=null;},_setupColourPreview:function(){var container=$('colourSelector'),input=container.select('input')[0],currentColour=null,addColour,removeColour;input.observe('keypress',function(evt){var validChars=/[#a-f0-9]/gi;if(!String.fromCharCode(evt.keyCode).match(validChars)&&evt.keyCode!==Event.KEY_BACKSPACE&&evt.keyCode!==Event.KEY_DELETE)
{evt.returnValue=false;return;}});input.observe('focus',function(){if(input.value===this.DEFAULT_COLOUR_LABEL){input.value='';}}.bind(this));input.observe('blur',function(){if(input.value===''){input.value=this.DEFAULT_COLOUR_LABEL;}}.bind(this));input.observe('keyup',function(){var value=input.value.gsub('#','');if((value.length===3||value.length===6)&&value!==this.DEFAULT_COLOUR_LABEL){this._updateColourPreview(value);this._previousColour=value;}else{this._resetColourPreview();}}.bind(this));document.observe(istock.search.event.REMOVE_FACET,function(evt){if(evt.memo.facet.type===istock.search.facetTypes.COLOUR){this._resetColourPreview();document.fire('colourPicker:clearSelected');input.value=this.DEFAULT_COLOUR_LABEL;}}.bind(this));document.observe(istock.search.event.ADD_FACET,function(evt){var facet=evt.memo.facet;if(facet.type===istock.search.facetTypes.COLOUR){document.fire('colourPicker:setLastSelected',facet.value);this._updateColourPreview(facet.value);input.value=facet.value;this._previousColour=facet.value;}}.bind(this));if(istock.widget.ColourPicker.isSupported()){container.observe('colourPicker:display',function(evt){if(evt.memo.clear){this._resetColourPreview();}else if(evt.memo.hex){this._updateColourPreview(evt.memo.hex);}}.bind(this));container.observe('colourPicker:select',function(evt){if(evt.memo.hex){this._updateColourPreview(evt.memo.hex);input.value=evt.memo.hex;}else if(evt.memo.nothingSelected&&this._previousColour){this._updateColourPreview(this._previousColour);input.value=this._previousColour;}else{this._resetColourPreview();input.value=this.DEFAULT_COLOUR_LABEL;this._previousColour=null;}}.bind(this));}},_updateColourPreview:function(hex){var sample=$('colourPickerSample');sample.removeClassName('defaultBg');sample.setStyle({background:'#'+hex});},_resetColourPreview:function(){var sample=$('colourPickerSample');sample.writeAttribute('style','');sample.addClassName('defaultBg');this._previousColor=null;},_addColourFacet:function(hex){this._currentColour=hex;this._fireColourFacet(istock.search.event.ADD_FACET,hex);},_removeColourFacet:function(){if(this._currentColour){this._fireColourFacet(istock.search.event.REMOVE_FACET,this._currentColour);this._currentColour=null;}},_fireColourFacet:function(action,value){if(value.length===3){value=value.charAt(0)+value.charAt(0)+value.charAt(1)+value.charAt(1)+value.charAt(2)+value.charAt(2);}
istock.search.event.fire(action,new istock.search.Facet.factory(istock.search.facetTypes.COLOUR,value,'Colour'));},_setupCopySpace:function(){var grid=$('copySpaceGrid');if(!grid){throw'CopySpace grid could not be found';}
grid.select('div').each(function(cell){cell.observe('click',function(){cell.toggleClassName('active');});});$$('#copySpaceSelector a')[0].observe('click',function(evt){evt.stop();if(grid.select('div.active').length>0){this._addCopySpaceFacet();}else{this._removeCopySpaceFacet();}}.bind(this));document.observe(istock.search.event.REMOVE_FACET,function(evt){if(evt.memo.facet.type===istock.search.facetTypes.COPY_SPACE){grid.select('div').invoke('removeClassName','active');}}.bind(this));document.observe(istock.search.event.ADD_FACET,function(evt){var facet=evt.memo.facet;if(facet.type===istock.search.facetTypes.COPY_SPACE){facet.value.each(function(coord){var cell=grid.select('div.cs'+coord.key)[0];if(cell){cell.addClassName('active');}});this._prevCopySpaceValues=facet.value;}}.bind(this));this._prevCopySpaceValues=null;},_addCopySpaceFacet:function(){var values=[];$$('#copySpaceGrid div').each(function(cell){var coord;if(cell.hasClassName('active')){coord=$w(cell.className)[0].gsub('cs','');values.push({key:coord,value:'Space'});}});this._prevCopySpaceValues=values;this._fireEventCopySpace(istock.search.event.ADD_FACET,values);},_removeCopySpaceFacet:function(){if(this._prevCopySpaceValues){this._fireEventCopySpace(istock.search.event.REMOVE_FACET,this._prevCopySpaceValues);this._prevCopySpaceValues=null;}},_fireEventCopySpace:function(action,values){istock.search.event.fire(action,new istock.search.Facet.factory(istock.search.facetTypes.COPY_SPACE,values,'CopySpace&trade;'));},_fireEventOrientation:function(action,value,title){istock.search.event.fire(action,new istock.search.facet.Orientation(value,((title.blank())?this._title(value):title)));},_title:function(value){switch(parseInt(value,10)){case this.ORIENTATION_TYPES.VERTICAL:return translations.search.filters.orientation.vertical;case this.ORIENTATION_TYPES.SQUARE:return translations.search.filters.orientation.square;case this.ORIENTATION_TYPES.HORIZONTAL:return translations.search.filters.orientation.horizontal;default:throw'Unknown orientation.';}}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.PhotoIllustration();});namespacing.init('istock.search.filters');istock.search.filters.Video=Class.create({VIDEO_TYPES:{'STANDARD_PAL':21,'STANDARD_DV':33,'STANDARD_NTSC':18,'WIDESCREEN_720':24,'WIDESCREEN_1080':23,'WIDESCREEN_ANAMORPHIC':1},initialize:function(){var obj=new istock.search.FacetListener($$('#videoResolution_list input[type="checkbox"]'),istock.search.facetTypes.VIDEO);obj=new istock.search.FacetListener($$('#videoAspect_list input[type="checkbox"]'),istock.search.facetTypes.ASPECT_RATIO_VIDEO);}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Video();});namespacing.init('istock.search.filters');istock.search.filters.Audio=Class.create({UNDEFINED_KEY:1,_prevValues:{},initialize:function(){var obj=new istock.search.FacetListener($$('#audioPrice_list input[type="checkbox"]'),istock.search.facetTypes.AUDIO_PRICE);var objKeyListen=new istock.search.FacetListenerSelect($('key_options'),istock.search.facetTypes.KEY,this._fireKeyFacet.bind(this));var objTempListen=new istock.search.FacetListenerSelect($('tempo_options'),istock.search.facetTypes.TEMPO);[1,2].each(function(num){var objSigListen=new istock.search.FacetListenerSelect(this._sigSelect(num),istock.search.facetTypes['TIME_SIGNATURE_'+num],this._fireSignatureFacet.bind(this));}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.TIME_SIGNATURE_1){this._fireSigEvent([2],istock.search.event.REMOVE_FACET);}}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){var facetType=event.memo.facet.type;if(facetType===istock.search.facetTypes.TIME_SIGNATURE_1||facetType===istock.search.facetTypes.TIME_SIGNATURE_2||facetType===istock.search.facetTypes.KEY||facetType===istock.search.facetTypes.TEMPO){var index=event.memo.facet.value;switch(facetType){case istock.search.facetTypes.TIME_SIGNATURE_1:index=0;select=$('time_signature_1_options');break;case istock.search.facetTypes.TIME_SIGNATURE_2:index=0;select=$('time_signature_2_options');break;case istock.search.facetTypes.KEY:index=0;select=$('key_options');break;case istock.search.facetTypes.TEMPO:index=0;select=$('tempo_options');break;default:break;}
$A(select.options).each(function(option,num){if(option.value===event.memo.facet.value){index=num;}}.bind(this));select.options[index].selected=true;}}.bind(this));},_fireSignatureFacet:function(action,value,title){if(this._isBothSigDefault()&&action===istock.search.event.REMOVE_FACET){this._fireSigEvent([1,2],action,value);this._fireSigEvent([1,2],action);}else{this._fireSigEvent([1,2],istock.search.event.ADD_FACET);}},_fireKeyFacet:function(action,value,title){istock.search.event.fire(action,istock.search.Facet.factory(istock.search.facetTypes.KEY,value,((parseInt(value)===this.UNDEFINED_KEY)?title+' key':title)));},_fireSigEvent:function(sigs,action,value){var useCurrent=Object.isUndefined(value)?true:false
sigs.each(function(num){istock.search.event.fire(action,istock.search.Facet.factory(istock.search.facetTypes['TIME_SIGNATURE_'+num],(useCurrent?this._getSigValue(num):value),this._getCombinedSigText()));}.bind(this));},_getText:function(ele){return ele.options[ele.selectedIndex].text;},_getCombinedSigText:function(){return this._getText(this._sigSelect(1))
+'/'
+this._getText(this._sigSelect(2));},_getSigValue:function(num){return this._sigSelect(num).getValue();},_sigSelect:function(num){return $('time_signature_'+num+'_options');},_isBothSigDefault:function(){return(this._sigSelect(1).selectedIndex===0)&&(this._sigSelect(2).selectedIndex===0);}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Audio();});namespacing.init('istock.search.filters');istock.search.filters.Collections=Class.create({VALUE_BIN:8,initialize:function(){var obj=new istock.search.FacetListener($$('#collections_list input[type="checkbox"]'),istock.search.facetTypes.COLLECTIONS);if(istock.search.dollarbinoverride){$('valueBin').show();return;}
Event.observe(document,istock.search.event.ADD_FACET,function(event){var type=event.memo.facet.type,value=parseInt(event.memo.facet.value,10);if(type===istock.search.facetTypes.COLLECTIONS&&value===istock.search.collections.VALUE_BIN){$('valueBin').show();}}.bind(this));}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Collections();});istock.search.collections={VALUE_BIN:8,PUMP_AUDIO:99};namespacing.init('istock.search.filters');istock.search.filters.Attributes=Class.create({initialize:function(){var obj=new istock.search.FacetListener($$('#people_list input[type="checkbox"]'),istock.search.facetTypes.SHOW_PEOPLE);var obj=new istock.search.FacetListener($$('#exclusive_list input[type="checkbox"]'),istock.search.facetTypes.EXCLUSIVE);var obj=new istock.search.FacetListenerSelect($('filesfrom_options'),istock.search.facetTypes.FILES_FROM);Event.observe(document,istock.search.event.ADD_FACET,function(event){var facetType=event.memo.facet.type;if(facetType===istock.search.facetTypes.FILES_FROM){var index=event.memo.facet.value;select=$('filesfrom_options');$A(select.options).each(function(option,num){if(option.value===event.memo.facet.value){index=num;}}.bind(this));select.options[index].selected=true;}}.bind(this));}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Attributes();});namespacing.init('istock.search.filters');istock.search.filters.Categories=Class.create({SELECTED_SUB_CATEGORY:'selectedSubCategory',UNSELECTED_SUB_CATEGORY:'subCategoryLink',_categories:[],_existingCategories:{},initialize:function(categories){this._categories=categories;this._renderTopLevel();Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.CATEGORY){this._removeFacet(event.memo.facet,this._categories.categoryFromId(event.memo.facet.value).depth);}}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.CATEGORY){var category=this._categories.categoryFromId(event.memo.facet.value);if(category.depth>1){this._selectCategory(this._categories.getParent(category));this._selectSubCategory(category.id);}else{this._selectCategory(category);}
this._existingCategories[category.depth]=category;}}.bind(this));},_addSubListClass:function(){this._container().addClassName('subList');},_removeSubListClass:function(){this._container().removeClassName('subList');},_selectCategory:function(category){if(Object.isUndefined(this._existingCategories[category.depth])||this._existingCategories[category.depth].id!==category.id)
{this._addSubListClass();this._renderSubLevel(category.label,category.children);}
this._existingCategories[category.depth]=category;},_removeFacet:function(facet,depth){this._existingCategories[depth]=undefined;if(depth>1){this._selectSubCategory(this._getSubLink(facet.value),false);}
if(depth===1){this._renderTopLevel();this._removeAllExisting();}},_getSubLink:function(value){return this._subCategoryLinks().find(function(ele){return(ele.identify()===value);});},_subCategoryLinks:function(){return $$('.'+this.SELECTED_SUB_CATEGORY);},_renderTopLevel:function(){this._container().update('');this._removeSubListClass();this._categories.getData().each(function(category){this._container().insert(this._constructLink(category));}.bind(this));this._attachMoreLink();this._hideMost();},_attachMoreLink:function(){this._container().insert(this._moreLink());},_moreLink:function(){return new Element('img',{'src':istock.cookielessUrl+'/static/images/buttons/search/tabs/'+istock.siteLang+'/moreTab.gif','class':'categoryMore cp'}).observe('click',function(e){this._showAll();$$('.categoryMore').shift().replace(this._lessLink());document.fire(istock.search.event.TOGGLE_FILTER);}.bind(this));},_lessLink:function(){return new Element('img',{'src':istock.cookielessUrl+'/static/images/buttons/search/tabs/'+istock.siteLang+'/lessTab.gif','class':'categoryLess cp'}).observe('click',function(e){this._hideMost();$$('.categoryLess').shift().replace(this._moreLink());document.fire(istock.search.event.TOGGLE_FILTER);}.bind(this));},_hideMost:function(){this._categoryLinkList().slice(5,this._categoryLinkList().size()).each(function(ele){ele.hide();});},_showAll:function(){this._categoryLinkList().each(function(ele){ele.show();}.bind(this));},_categoryLinkList:function(){return $$('#categories_filter .categoryLink','#categories_filter .subCategoryLink');},_renderSubLevel:function(heading,categories){this._container().update('');this._container().insert(this._allLink());this._container().insert(this._headingText(heading));categories.each(function(category){this._container().insert(this._subCategoryLink(category));}.bind(this));this._attachMoreLink();this._hideMost();},_subCategoryLink:function(category){return new Element('div',{'id':category.id,'class':this.UNSELECTED_SUB_CATEGORY}).update(category.label).observe('click',function(e){this._addFacet(category);}.bind(this));},_selectSubCategory:function(ele,isSelected){var removeClass=this.SELECTED_SUB_CATEGORY,addClass=this.UNSELECTED_SUB_CATEGORY;if(Object.isUndefined(ele)){return;}
ele=$(ele);ele.show();isSelected=(Object.isUndefined(isSelected))?true:isSelected;if(isSelected){removeClass=this.UNSELECTED_SUB_CATEGORY;addClass=this.SELECTED_SUB_CATEGORY;}
ele.removeClassName(removeClass);ele.addClassName(addClass);},_deselectAllSub:function(){this._subCategoryLinks().each(function(ele){this._selectSubCategory(ele,false);}.bind(this));},_headingText:function(heading){return new Element('div',{'class':'categoryHeader'}).update(heading);},_allLink:function(){return new Element('div',{'class':'categoryLink'}).update('&lt;'+translations.search.filters.categories.all).observe('click',function(e){this._removeAllExisting();}.bind(this));},_removeAllExisting:function(){Object.values(this._existingCategories).each(function(category){if(!Object.isUndefined(category)){this._fireEvent(istock.search.event.REMOVE_FACET,category);}}.bind(this));},_container:function(){return $('categories_list');},_constructLink:function(category){return new Element('div',{'class':'categoryLink'}).update(category.label).observe('click',function(e){this._addFacet(category);}.bind(this));},_addFacet:function(category){if(!Object.isUndefined(this._existingCategories[category.depth])){this._fireEvent(istock.search.event.REMOVE_FACET,this._existingCategories[category.depth]);}
this._fireEvent(istock.search.event.ADD_FACET,category);},_fireEvent:function(action,category){istock.search.event.fire(action,this._generateFacet(category));},_generateFacet:function(category){if(category.depth===1){return new istock.search.facet.Category(category.id,category.label);}else{return new istock.search.facet.SubCategory(category.id,category.label);}}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Categories(new istock.search.Categories());});namespacing.init('istock.search.filters');istock.search.filters.Price=Class.create({_priceValue:[0,-1],initialize:function(){var facetType=istock.search.facetTypes.PRICE,slices={};if(!$('priceLevelHandle1')||!$('priceLevelHandle2')||!$('priceLevelTrack')){return;}
this._setupPriceWidget();$$('#priceLevelSlices li').each(function(v,k){slices[Math.pow(2,istock.search.filters.Price.PRICE_RANGE_SLICES-k-1)]=v;}.bind(this));new istock.search.FacetListenerSlicer(this._slicer,facetType,slices,'top');this._slicer.options.onDisable=function(){$('priceLevelTrack').addClassName('disableSlicer');$H(slices).each(function(pair){$(pair[1]).addClassName('disabled');});};this._slicer.options.onEnable=function(){$('priceLevelTrack').removeClassName('disableSlicer');};},_setupPriceWidget:function(){var handles=[$('priceLevelHandle1'),$('priceLevelHandle2')],track=$('priceLevelTrack'),options={axis:'vertical',rangeDiv:'priceLevelRange',onChange:this._slicerChanged.bind(this)},slicer;track.style.height='115px';handles[0].style.height=handles[1].style.height='9px';slicer=new istock.widget.Slicer(handles,track,istock.search.filters.Price.PRICE_RANGE_SLICES,options);$$('#priceLevelSlices div.priceLevelDotsWrapper').invoke('observe','click',function(e){var li=Element.up(e.element(),'li');if(!li.hasClassName('disabled')){slicer[e.shiftKey?'extendToSlice':'selectSlice'](li.previousSiblings().size());}
e.stop();return false;});this._slicer=slicer;this._priceValue=[0,istock.search.filters.Price.PRICE_RANGE_SLICES];},_slicerChanged:function(values){var action=istock.search.event.ADD_FACET;if(values[0]===0&&values[1]===istock.search.filters.Price.PRICE_RANGE_SLICES){action=istock.search.event.REMOVE_FACET;values=this._priceValue;this._priceValue=[0,istock.search.filters.Price.PRICE_RANGE_SLICES];document.fire("omniture:priceRangeEvent","None");}else{this._priceValue=values;var left=parseInt(istock.search.filters.Price.PRICE_RANGE_SLICES-values[1]+1);var right=parseInt(istock.search.filters.Price.PRICE_RANGE_SLICES-values[0]);if(left===right){var priceRange=left.toString();}else{var priceRange=left+':'+right;}
document.fire("omniture:priceRangeEvent",priceRange);}
istock.search.event.fire(action,new istock.search.facet.Price(values,this._title(values)));},_title:function(value){if(value[0]+1===value[1]){return'<div class="priceLevelIcon"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="priceLevelIcon'+value[0]+'" /></div>';}else{return'<div class="priceLevelIcon"><img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="priceLevelIcon'+(value[1]-1)+'" /> - <img src="'+istock.cookielessUrl+'/static/images/blank.gif" class="priceLevelIcon'+value[0]+'" /></div>';}}});istock.search.filters.Price.PRICE_RANGE_SLICES=4;Event.observe(document,'search:loaded',function(){var obj=new istock.search.filters.Price();});namespacing.init('istock.search.event');istock.search.event.namespace='facetedSearch:';istock.search.event={ADD_FACET:istock.search.event.namespace+'add_facet',REMOVE_FACET:istock.search.event.namespace+'remove_facet',UPDATE_FACET:istock.search.event.namespace+'update_facet',NEW_RESULTS:istock.search.event.namespace+'resultsUpdated',NEW_PAGE:istock.search.event.namespace+'new_page',QUERY_BUILDER_REDRAW:istock.search.event.namespace+'query_builder_redraw',DISAMBIG_DETECTED:istock.search.event.namespace+'disamgibuation_detected',DISAMBIG_REQUESTED:istock.search.event.namespace+'disamgibuation_requested',SPELLING_DETECTED:istock.search.event.namespace+'spelling_detected',SPELLING_REQUESTED:istock.search.event.namespace+'spelling_requested',RESULT_SET_UPDATED:istock.search.event.namespace+'result_set_updated',SEARCH_ERROR:istock.search.event.namespace+'search_error',UPDATE_TITLE:istock.search.event.namespace+'update_title',TOGGLE_FILTER:istock.search.event.namespace+'toggle_filter',RESULTS_RENDERED:istock.search.event.namespace+'results_rendered',ZERO_RESULTS:istock.search.event.namespace+'zero_results',fire:function(action,memo,arg){document.fire(action,this._createMemo(action,memo,arg));},_createMemo:function(action,memo,arg){switch(action){case this.ADD_FACET:case this.REMOVE_FACET:case this.NEW_PAGE:return{'facet':memo,'isRenderOnly':((arg!==undefined)?arg:false)};case this.UPDATE_FACET:return{'oldFacet':memo,'newFacet':arg};case this.DISAMBIG_REQUESTED:case this.SPELLING_REQUESTED:return{'title':arg,'container':memo};default:return memo;}}};namespacing.init('istock.search');istock.search.Facet=Class.create({_isMultiple:false,_isNullComplete:false,_maxSize:1,initialize:function(type,value,title){this.type=type;this.value=(Object.isNumber(value))?new String(value):value;this.title=title;},maxSize:function(){return this._maxSize;},isMultipleAllowed:function(){return this._isMultiple;},isNullComplete:function(size){return this._isNullComplete&&size>=this._maxSize;},setMultiple:function(flag){this._isMultiple=flag;},setNullComplete:function(flag){this._isNullComplete;},isEqual:function(compareTo){return(this.type===compareTo.type&&Object.toJSON(this.value)===Object.toJSON(compareTo.value));}});Object.extend(istock.search.Facet,{factory:function(facetType,value,title){var classMap={};classMap[istock.search.facetTypes.FILE_TYPE]='FileType';classMap[istock.search.facetTypes.KEYWORD]='Keyword';classMap[istock.search.facetTypes.ORIENTATION]='Orientation';classMap[istock.search.facetTypes.PHOTO_SIZE]='PhotoSize';classMap[istock.search.facetTypes.ILLUSTRATION_PRICE]='IllustrationPrice';classMap[istock.search.facetTypes.VIDEO]='Video';classMap[istock.search.facetTypes.COLLECTIONS]='Collections';classMap[istock.search.facetTypes.AUDIO_PRICE]='AudioPrice';classMap[istock.search.facetTypes.SHOW_PEOPLE]='ShowPeople';classMap[istock.search.facetTypes.DISAMBIGUATION]='Disambiguation';classMap[istock.search.facetTypes.CATEGORY]='Category';classMap[istock.search.facetTypes.COPY_SPACE]='CopySpace';classMap[istock.search.facetTypes.COLOUR]='Colour';classMap[istock.search.facetTypes.RESTRICT_ADULT_CONTENT]='FilterContent';classMap[istock.search.facetTypes.LICENSE_GROUP]='LicenseGroup';classMap[istock.search.facetTypes.PRICE]='Price';classMap[istock.search.facetTypes.ASPECT_RATIO_VIDEO]='AspectRatioVideo';if(Object.isUndefined(istock.search.facet[classMap[facetType]])){return new istock.search.Facet(facetType,value,title);}else{return new istock.search.facet[classMap[facetType]](value,title);}},getFilterType:function(facetType){switch(facetType){case istock.search.facetTypes.FILE_TYPE:return istock.search.filterTypes.FILE_TYPES;case istock.search.facetTypes.KEYWORD:return istock.search.filterTypes.KEYWORD;case istock.search.facetTypes.PORTFOLIO:return istock.search.filterTypes.PORTFOLIO;case istock.search.facetTypes.LIGHTBOX:return istock.search.filterTypes.LIGHTBOX;case istock.search.facetTypes.ORIENTATION:case istock.search.facetTypes.PHOTO_SIZE:case istock.search.facetTypes.COPY_SPACE:case istock.search.facetTypes.COLOUR:case istock.search.facetTypes.ILLUSTRATION_PRICE:return istock.search.filterTypes.PHOTO_ILLUSTRATION;case istock.search.facetTypes.COLLECTIONS:return istock.search.filterTypes.COLLECTIONS;case istock.search.facetTypes.VIDEO:case istock.search.facetTypes.ASPECT_RATIO_VIDEO:return istock.search.filterTypes.VIDEO;case istock.search.facetTypes.AUDIO_PRICE:case istock.search.facetTypes.TEMPO:case istock.search.facetTypes.KEY:case istock.search.facetTypes.TIME_SIGNATURE_1:return istock.search.filterTypes.AUDIO;case istock.search.facetTypes.SHOW_PEOPLE:case istock.search.facetTypes.EXTENDED_LICENSE:case istock.search.facetTypes.EXCLUSIVE:case istock.search.facetTypes.FILES_FROM:return istock.search.filterTypes.MORE_ATTRIBUTES;case istock.search.facetTypes.LICENSE_GROUP:return istock.search.filterTypes.LICENSE_GROUP;case istock.search.facetTypes.CATEGORY:return istock.search.filterTypes.CATEGORIES;case istock.search.facetTypes.PRICE:return istock.search.filterTypes.PRICE;default:throw translations.search.filters.types.unknown;}}});namespacing.init('istock.search');istock.search.FacetListener=Class.create({_facetType:null,initialize:function(inputs,facetType,fireEventCallback){this._inputs=inputs;this._fireEventCallback=fireEventCallback;this._facetType=facetType;this._facets().each(function(ele){Event.observe(ele,'click',function(event){this._fireEvent(this._facetEvent(ele.checked),ele.value,ele.up().collectTextNodes(),facetType);this._updateFacetDisplay(facetType);}.bind(this));}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===facetType){this._uncheckFacet(event.memo.facet);}}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){if(event.memo.facet.type===facetType){this._checkFacet(event.memo.facet);}}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){var whatIfs=event.memo.whatIfs;this._clearWhatIfs();if(!Object.isUndefined(whatIfs)){this._applyWhatIfs(whatIfs);}}.bind(this));},_applyWhatIfs:function(whatIfs){Object.keys(whatIfs).each(function(type){if(this._matchesFacetType(type)){this._applyWhatIfType(whatIfs[type]);}}.bind(this));},_applyWhatIfType:function(whatIf){Object.keys(whatIf).each(function(whatIfKey){this._facets().each(function(input){if(input.value===whatIfKey){this._renderWhatIf(input,whatIfKey,whatIf[whatIfKey]);}}.bind(this));}.bind(this));},_matchesFacetType:function(type){return parseInt(type)===this._facetType;},_renderWhatIf:function(input,whatIfKey,whatIfValue){input.up().insert({after:new Element('span',{'class':'whatIf'+'_'+this._facetType,'id':'whatif_'+this._facetType+'_'+whatIfKey}).update('('+whatIfValue+')')});if(parseInt(whatIfValue)===0){input.writeAttribute('disabled');input.up(1).setStyle({opacity:0.5,'filter':'alpha(opacity = 50)'});}},_clearWhatIfs:function(inputs){$$('.whatIf'+'_'+this._facetType).invoke('remove');this._facets().each(function(ele){if(!Object.isUndefined(ele.up(1))){ele.writeAttribute('disabled',false);ele.up(1).setStyle({opacity:1,'filter':'alpha(opacity = 100)'});}}.bind(this));},_fireEvent:function(action,value,title,facetType){if(Object.isUndefined(this._fireEventCallback)){istock.search.event.fire(action,istock.search.Facet.factory(facetType,value,title));}else{this._fireEventCallback(action,value,title,facetType);}},_uncheckFacet:function(facet){this._facets().each(function(ele){if(ele.value===facet.value){ele.checked=false;}});},_checkFacet:function(facet){this._facets().each(function(ele){if(ele.value===facet.value){ele.checked=true;}});},_facets:function(){return this._inputs;},_updateFacetDisplay:function(facetType){if(this._isAllChecked()&&this._isFacetNullComplete(facetType)){this._facets().each(function(ele){ele.checked=false;});}},_isFacetNullComplete:function(facetType){return istock.search.Facet.factory(facetType,null,null).isNullComplete(this._inputs.size());},_isAllChecked:function(){var allChecked=true;this._facets().each(function(ele){if(!ele.checked){allChecked=false;}});return allChecked;},_facetEvent:function(flag){if(flag){return istock.search.event.ADD_FACET;}else{return istock.search.event.REMOVE_FACET;}}});namespacing.init('istock.search');istock.search.FacetListenerSelect=Class.create({_prevValues:{},initialize:function(select,facetType,fireEventCallback){this._fireEventCallback=fireEventCallback;select.observe('change',function(event){var ele=event.element();if(this._isDefaultSelected(ele)){this._fireRemove(ele,facetType);}else{this._fireAdd(ele,facetType);}
this._prevValues[ele.id]=ele.getValue();}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===facetType){select.options[0].selected=true;}}.bind(this));},_fireAdd:function(ele,facetType){this._fireEvent(istock.search.event.ADD_FACET,ele.getValue(),this._getText(ele),facetType);},_fireRemove:function(ele,facetType){this._fireEvent(istock.search.event.REMOVE_FACET,this._prevValues[ele.id],this._getText(ele),facetType);},_fireEvent:function(action,value,title,facetType){if(Object.isUndefined(this._fireEventCallback)){istock.search.event.fire(action,istock.search.Facet.factory(facetType,value,title));}else{this._fireEventCallback(action,value,title,facetType);}},_isDefaultSelected:function(ele){return(ele.selectedIndex==0);},_getText:function(ele){return ele.options[ele.selectedIndex].text;}});namespacing.init('istock.search');istock.search.FacetListenerSlicer=Class.create({initialize:function(slicer,facetType,slices,position){this._facetType=facetType;this._slicer=slicer;this._slices=$H(slices);this._whatIfPosition=position||'bottom';Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===facetType){this._slicer.clearSelection();}}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){if(event.memo.facet.type===facetType){this._slicer.populateValues(event.memo.facet.value);}}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){var whatIfs=event.memo.whatIfs;if(!Object.isUndefined(whatIfs)){this._applyWhatIfs(whatIfs);}}.bind(this));},_applyWhatIfs:function(whatIfs){var hasAny=false;if(!Object.isUndefined(whatIfs[this._facetType])){this._clearWhatIfs();this._slices.each(function(pair){var sliceKey=parseInt(pair[0],10),slice=pair[1],whatIfValue=whatIfs[this._facetType][sliceKey];if(!Object.isUndefined(whatIfValue)){this._renderWhatIf(slice,whatIfValue);if(parseInt(whatIfValue,10)!==0){hasAny=true;}}else{this._renderWhatIf(slice,0);}}.bind(this));}
this._slicer[hasAny?'setEnabled':'setDisabled']();},_clearWhatIfs:function(){$$('.whatIf_'+this._facetType).invoke('remove');},_renderWhatIf:function(slice,whatIfValue){var insert={},disableSlice=parseInt(whatIfValue,10)===0;insert[this._whatIfPosition]=new Element('span',{'class':'whatIf'+'_'+this._facetType}).update('('+whatIfValue+')');slice.insert(insert);slice[disableSlice?'addClassName':'removeClassName']('disabled');}});namespacing.init('istock.search.facet');istock.search.facet.FileType=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.FILE_TYPE,value,title);this._maxSize=istock.search.filters.FileType.numFileTypes();}});namespacing.init('istock.search.facet');istock.search.facet.AspectRatioVideo=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.ASPECT_RATIO_VIDEO,value,title);this._maxSize=$$('#videoAspect_list input[type="checkbox"]').size();}});namespacing.init('istock.search.facet.FileType');istock.search.facet.Keyword=Class.create(istock.search.Facet,{_isMultiple:true,initialize:function($super,value,title){$super(istock.search.facetTypes.KEYWORD,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.Orientation=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.ORIENTATION,value,title);this._maxSize=3;}});namespacing.init('istock.search.facet');istock.search.facet.PhotoSize=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.PHOTO_SIZE,value,title);this._maxSize=3;}});namespacing.init('istock.search.facet');istock.search.facet.CopySpace=Class.create(istock.search.Facet,{_isNullComplete:false,_isMultiple:false,_maxSize:1,initialize:function($super,value,title){$super(istock.search.facetTypes.COPY_SPACE,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.Colour=Class.create(istock.search.Facet,{_isNullComplete:false,_isMultiple:false,_maxSize:1,initialize:function($super,value,title){$super(istock.search.facetTypes.COLOUR,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.IllustrationPrice=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.ILLUSTRATION_PRICE,value,title);this._maxSize=5;}});namespacing.init('istock.search.facet');istock.search.facet.Video=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.VIDEO,value,title);this._maxSize=5;}});namespacing.init('istock.search.facet');istock.search.facet.AudioPrice=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.AUDIO_PRICE,value,title);this._maxSize=$$('#audioPrice_list input[type="checkbox"]').size();}});namespacing.init('istock.search.facet');istock.search.facet.Collections=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:false,initialize:function($super,value,title){$super(istock.search.facetTypes.COLLECTIONS,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.ShowPeople=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:false,initialize:function($super,value,title){$super(istock.search.facetTypes.SHOW_PEOPLE,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.Disambiguation=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:false,initialize:function($super,value,title){var objValue={};if(Object.isArray(value)){objValue[title]=value;}else if(title in value){objValue=value;}
$super(istock.search.facetTypes.DISAMBIGUATION,objValue,title);}});namespacing.init('istock.search.facet');istock.search.facet.Category=Class.create(istock.search.Facet,{_isMultiple:false,_isNullComplete:false,_maxSize:1,initialize:function($super,value,title,depth){this._depth=(Object.isUndefined(depth))?1:depth;$super(istock.search.facetTypes.CATEGORY,value,title);},getDepth:function(){return this._depth;}});namespacing.init('istock.search.facet');istock.search.facet.SubCategory=Class.create(istock.search.facet.Category,{_maxSize:2,initialize:function($super,value,title){$super(value,title,2);}});namespacing.init('istock.search.facet');istock.search.facet.FilterContent=Class.create(istock.search.Facet,{_isNullComplete:false,_isMultiple:false,_maxSize:1,initialize:function($super,value,title){$super(istock.search.facetTypes.RESTRICT_ADULT_CONTENT,value,title);}});namespacing.init('istock.search.facet');istock.search.facet.LicenseGroup=Class.create(istock.search.Facet,{_isMultiple:true,_isNullComplete:true,initialize:function($super,value,title){$super(istock.search.facetTypes.LICENSE_GROUP,value,title);this._maxSize=2;}});namespacing.init('istock.search.facet');istock.search.facet.Price=Class.create(istock.search.Facet,{_isNullComplete:false,_isMultiple:false,_maxSize:1,initialize:function($super,value,title){$super(istock.search.facetTypes.PRICE,value,title);}});namespacing.init('istock.search');istock.search.Breadbox=Class.create({_facetStack:null,initialize:function()
{Event.observe(document,istock.search.event.ADD_FACET,function(event){this._addFacet(event.memo.facet);}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){this._removeFacet(event.memo.facet);}.bind(this));this._facetStack=new istock.search.FacetStack();this._display=new istock.search.breadbox.Display(function(obj){this._handleFacetRemoval(obj)}.bind(this),function(){this._removeAllFacets();}.bind(this));},_filters:function(){return this._facetStack.filters();},_facets:function(filterType){return this._facetStack.facets(filterType);},_removeFacet:function(facet){this._facetStack.removeFacet(facet);this._render();},_addFacet:function(obj){this._facetStack.addFacet(obj);this._render();},_render:function(){this._display.render(this._filters());},_removeAllFacets:function(){this._filters().each(function(filter){filter.facets.clone().each(function(facet){this._fireRemoveFacet(facet);}.bind(this));}.bind(this));},_handleFacetRemoval:function(facet){this._fireRemoveFacet(facet);if(facet.type===istock.search.facetTypes.KEYWORD){this._removeDisambig(facet);}else if(facet.type===istock.search.facetTypes.PRICE){document.fire("omniture:priceRangeEvent","None");}},_fireRemoveFacet:function(facet){istock.search.event.fire(istock.search.event.REMOVE_FACET,new istock.search.Facet(facet.type,facet.value,facet.title));},_removeDisambig:function(keywordFacet){this._facetStack.facets(istock.search.facetTypes.DISAMBIGUATION).each(function(facet){if(keywordFacet.title===facet.title){this._fireRemoveFacet(facet);}}.bind(this));}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.Breadbox();});namespacing.init('istock.search');istock.search.FacetStack=Class.create({_facetData:null,initialize:function(){this._facetData={};},parse:function(data){this._facetData={};Object.values(data._facetData).each(function(filter){filter.facets.each(function(facet){this.addFacet(istock.search.Facet.factory(facet.type,facet.value,facet.title));}.bind(this));}.bind(this));return this;},initializeFilter:function(filterType){if(this._facetData[filterType]===undefined){this._facetData[filterType]={'facets':[]};}},facets:function(filterType){this.initializeFilter(filterType);return this._facetData[filterType].facets;},filters:function(){return Object.values(this._facetData);},addFacet:function(facet){var filterType=facet.type;if(!this._isMoreAllowed(filterType,facet)){this.facets(filterType).clear();}
this.facets(filterType).push(facet);if(facet.isNullComplete(this.facets(filterType).size())){this.facets(filterType).clear();}},removeFacet:function(facet){this.filters().each(function(filter){this._removeFromFilter(filter,facet);}.bind(this));},updateFacet:function(oldFacet,newFacet){this.removeFacet(oldFacet);this.addFacet(newFacet);},_isMoreAllowed:function(filterType,facet){return(facet.isMultipleAllowed()||(!facet.isMultipleAllowed()&&this.facets(filterType).size()<facet.maxSize()));},_removeFromFilter:function(filter,removeObj){var keep=[];filter.facets.clone().each(function(facet,index){if(!facet.isEqual(removeObj)){keep.push(facet);}}.bind(this));filter.facets=keep;},isInStack:function(facet){return(this._fetchFacet(facet)!==undefined);},_fetchFacet:function(facet){return this.facets(facet.type).find(function(obj){return obj.isEqual(facet);});}});namespacing.init('istock.search');istock.search.Container=Class.create({_facetStack:null,initialize:function(){var timeoutId=null,win={height:0,width:0};this._facetStack=new istock.search.FacetStack();Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.FILE_TYPE){this._facetStack.removeFacet(event.memo.facet);this._updateFilterDisplay();}
this.updateHeight();}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.FILE_TYPE){try{this._facetStack.addFacet(event.memo.facet);this._updateFilterDisplay();this._filterFromFacet(event.memo.facet).open();}catch(e){}}
this.updateHeight();}.bind(this));Event.observe(document,istock.search.event.SEARCH_ERROR,function(event){if(event.memo===istock.search.errorCodes.NO_RESULTS){this._disableAll();}else{(new istock.search.Filter('keyword')).close();this._disable(['filterContainer','keywordFilterHeading']);}
this.updateHeight();}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){this._enableAll();this.updateHeight();}.bind(this));Event.observe(document,istock.search.event.RESULTS_RENDERED,function(){this.updateHeight();}.bind(this));Event.observe(document,istock.search.event.TOGGLE_FILTER,function(){this.updateHeight();}.bind(this));Event.observe(window,'resize',function(e){var newWin={width:window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,height:window.innerheight||window.document.documentElement.clientheight||window.document.body.clientheight};if(newWin.height===win.height&&newWin.width===win.width){return;}else{win=newWin;}
window.clearTimeout(timeoutId);timeoutId=this.updateHeight.delay(0.1);}.bind(this));},_disableAll:function(){this._disable(['filterContainer','keywordContainer','categories_filter']);},_enableAll:function(){this._enable(['filterContainer','keywordContainer','categories_filter','keywordFilterHeading']);},_disable:function(idList){idList=(Object.isArray(idList))?idList:[idList];idList.each(function(id){$(id).addInputBlocker(['#colourPickerSample','#copySpaceGrid','#copySpaceBg']);});},_enable:function(idList){idList=(Object.isArray(idList))?idList:[idList];idList.each(function(id){$(id).removeInputBlocker(['#colourPickerSample','#copySpaceGrid','#copySpaceBg']);});},updateHeight:function(){$('queryBuilder').setStyle({'height':''});var qb=$('queryBuilder'),stl=$('searchTitle').getLayout(),scl=$('srchCntr').getLayout(),qbl=qb.getLayout(),qbuilder={mh:qbl.get('margin-box-height'),h:qbl.get('height')},results={mh:stl.get('margin-box-height')+scl.get('margin-box-height')};if(qbuilder.mh<results.mh){qb.setStyle({height:(results.mh-(qbuilder.mh-qbuilder.h))+'px'});$('searchContent-right').setStyle({height:results.mh+'px'});}else{$('searchContent-right').setStyle({height:qbuilder.mh+'px'});}},_margin:function(part,ele){return parseInt(ele.getStyle('margin-'+part),10);},_fileTypeFilters:function(){return[new istock.search.Filter('photoIllustration'),new istock.search.Filter('video'),new istock.search.Filter('audio')];},_updateFilterDisplay:function(){if(this._fileTypeFacets().size()<1){this._fileTypeFilters().invoke('show');return;}
this._fileTypeFilters().invoke('hide');this._fileTypeFacets().each(function(facet){try{this._filterFromFacet(facet).show();}catch(e){}}.bind(this));},_fileTypeFacets:function(){return this._facetStack.facets(istock.search.facetTypes.FILE_TYPE);},_filterFromFacet:function(facet){switch(parseInt(facet.value,10)){case istock.search.filters.FileType.getTypes().PHOTO:case istock.search.filters.FileType.getTypes().ILLUSTRATION:return new istock.search.Filter('photoIllustration');case istock.search.filters.FileType.getTypes().VIDEO:return new istock.search.Filter('video');case istock.search.filters.FileType.getTypes().AUDIO:return new istock.search.Filter('audio');default:throw translations.search.filters.types.unknown;}}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.Container();});namespacing.init('istock.search');istock.search.Handler=Class.create({SEARCH_DELAY:0.5,_facetStack:null,_lastSearchTime:0,_lastSearchToken:0,_lastSearchId:0,initialize:function(){this._facetStack=[];Event.observe(document,istock.search.event.ADD_FACET,function(event){this._addFacet(event.memo.facet,event.memo.isRenderOnly);}.bind(this));Event.observe(document,istock.search.event.UPDATE_FACET,function(event){this._updateFacet(event.memo.oldFacet,event.memo.newFacet);}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){this._removeFacet(event.memo.facet,event.memo.isRenderOnly);}.bind(this));Event.observe(document,istock.search.event.NEW_PAGE,function(event){this._newPage(event.memo.facet);}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){this._saveSearchToken(new istock.search.Adapter().parseResponse(event.memo).searchToken);this._saveSearchId(new istock.search.Adapter().parseResponse(event.memo).searchId);}.bind(this));this._facetStack=new istock.search.FacetStack();},_timestamp:function(){return new Date().getTime();},_newPage:function(facet){var facetStack=new istock.search.FacetStack();facetStack.addFacet(facet);facetStack.addFacet(this._searchIdFacet());var heatmap=this._facetStack.facets(istock.search.facetTypes.HEATMAP);if(heatmap&&(heatmap.length>0)&&parseInt(heatmap[0].value,10)>0){facetStack.addFacet(new istock.search.Facet.factory(istock.search.facetTypes.HEATMAP,heatmap[0].value,''));}
this._executeSearch(facetStack);},_searchIdFacet:function(){if(this._lastSearchId===undefined||this._lastSearchId===0){throw translations.search.handler.noSearchId;}
return new istock.search.Facet(istock.search.facetTypes.SEARCHID,this._lastSearchId,'search id');},_addFacet:function(facet,isRenderOnly){if(!this._facetStack.isInStack(facet)){this._facetStack.addFacet(facet);if(!isRenderOnly){this._executeSearch(this._facetStack);}}},_updateFacet:function(oldFacet,newFacet){this._facetStack.updateFacet(oldFacet,newFacet);this._executeSearch(this._facetStack);},_removeFacet:function(facet,isRenderOnly){this._facetStack.removeFacet(facet);if(!isRenderOnly){this._executeSearch(this._facetStack);}},_executeSearch:function(facetStack){if(!Object.isUndefined(this._pe)){this._pe.stop();}
istock.search.Handler.processFacetStack(facetStack);this._pe=new PeriodicalExecuter(function(pe){pe.stop();this._sendSearchRequest(facetStack);}.bind(this),this.SEARCH_DELAY);},_sendSearchRequest:function(facetStack){var objReq=new istock.search.Request();this._loadSpinner(true);objReq.execute({'filters':Object.toJSON(this._parseStack(facetStack))},function(response){if(this._isLastResponse(response.timestamp)){var objAdapter=new istock.search.Adapter();this._loadSpinner(false);istock.search.Handler.fireNewResultEvents(objAdapter.parseResponse(response));}}.bind(this));},_loadSpinner:function(showFlag){if(Object.isUndefined(this._spinner)){this._spinner=this._buildSpinner();}
if(showFlag){this._spinner.show();}else{this._spinner.hide();}},_buildSpinner:function(){var spinner=new Element('img',{'style':'position:absolute;top:40%;left:50%;','src':istock.cookielessUrl+'/static/images/loaderAnimation.gif'});document.body.insert(spinner);return spinner;},_parseStack:function(facetStack){var objAdapter=new istock.search.Adapter();var translatedFacetStack=objAdapter.translateFacetStack(facetStack,this._lastSearchTime=this._timestamp(),this._getSearchToken());translatedFacetStack.urlSeachToken=istock.calc.crc32(Object.toJSON(facetStack));return translatedFacetStack;},_getSearchToken:function(){return this._lastSearchToken;},_saveSearchToken:function(searchToken){this._lastSearchToken=searchToken;},_saveSearchId:function(searchId){this._lastSearchId=searchId;},_isLastResponse:function(timestamp){return(parseInt(timestamp,10)===this._lastSearchTime);}});Object.extend(istock.search.Handler,{fireNewResultEvents:function(result){istock.search.event.fire(istock.search.event.NEW_RESULTS,result);if(!Object.isUndefined(result.disambiguation)){istock.search.event.fire(istock.search.event.DISAMBIG_DETECTED,result.disambiguation);}
if(!Object.isUndefined(result.spelling)){istock.search.event.fire(istock.search.event.SPELLING_DETECTED,result.spelling);}
if(result.errorCode){istock.search.event.fire(istock.search.event.SEARCH_ERROR,result.errorCode);}},_preProcessors:[],registerPreProcessor:function(preProcessor){if(Object.isFunction(preProcessor.processFacetStack)){this._preProcessors.push(preProcessor);}},processFacetStack:function(facetStack){this._preProcessors.each(function(preProcessor){preProcessor.processFacetStack(facetStack);});}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.Handler();});namespacing.init('istock.search');istock.search.Adapter=Class.create({initialize:function(){},translateFacetStack:function(facetStack,timestamp,searchToken){return{'searchToken':searchToken,'timestamp':timestamp,'facets':this._parseStack(facetStack)};},parseResponse:function(response){if(response.status!==undefined){var resultStatus=parseInt(response.status);var resultCount=parseInt(response.resultCount);if(resultStatus!==1){return this._emptyResultSet(parseInt(response.errorCode));}else if(!resultCount){return this._emptyResultSet(istock.search.errorCodes.NO_RESULTS);}}
return response;},_emptyResultSet:function(errorCode){return{'resultCount':0,'totalResultCount':0,'results':[],'errorCode':errorCode};},_parseStack:function(facetStack){var data={};facetStack.filters().each(function(filter){filter.facets.each(function(facet){this._addFacet(facet,data);}.bind(this));}.bind(this));return data;},_addFacet:function(facet,data){if(facet.isMultipleAllowed()){if(data[facet.type]===undefined){data[facet.type]=[];}
data[facet.type].push(facet.value);}else{data[facet.type]=facet.value;}}});istock.search.errorCodes={SEARCH_FAILURE:1,LUST_FAILURE:2,NO_RESULTS:3};namespacing.init('istock.search');istock.search.Request=Class.create({_returnJSON:true,_ajaxURL:'',initialize:function(){this._ajaxURL='/json/search/';},execute:function(params,callback){var paramHash=new Hash(params);new Ajax.Request(this._ajaxURL,{parameters:paramHash,onSuccess:function(transport){callback((this._returnJSON)?transport.responseText.evalJSON(true):transport.responseText);}.bind(this),onFailure:function(){}.bind(this)});}});namespacing.init('istock.search');istock.search.facetTypes={SEARCHID:0,LIGHTBOX:2,PORTFOLIO:3,COLOUR:4,COPY_SPACE:5,COLLECTIONS:7,RESTRICT_ADULT_CONTENT:9,ORIENTATION:20,RESULT_ORDER:25,WEIGHTING:26,PER_PAGE:30,FILE_TYPE:34,KEYWORD:35,DISAMBIGUATION:36,PAGE_NUMBER:39,PHOTO_SIZE:41,ILLUSTRATION_PRICE:42,VIDEO:44,AUDIO_PRICE:45,TEMPO:15,KEY:16,TIME_SIGNATURE_1:17,TIME_SIGNATURE_2:18,SHOW_PEOPLE:12,EXTENDED_LICENSE:11,EXCLUSIVE:21,FILES_FROM:19,CATEGORY:28,PRICE:46,ADDITIONAL_AUDIO:1003,LICENSE_GROUP:1004,ASPECT_RATIO_VIDEO:1012};namespacing.init('istock.search');istock.search.filterTypes={LIGHTBOX:translations.search.filters.types.lightbox,PORTFOLIO:translations.search.filters.types.portfolio,KEYWORD:translations.search.filters.types.keywords,FILE_TYPES:translations.search.filters.types.fileTypes,PHOTO_ILLUSTRATION:translations.search.filters.types.photoIllustrationFilter,VIDEO:translations.search.filters.types.videoFilter,AUDIO:translations.search.filters.types.audioFilter,COLLECTIONS:translations.search.filters.types.collections,MORE_ATTRIBUTES:translations.search.filters.types.moreAttributes,CATEGORIES:translations.search.filters.types.categories,LICENSE_GROUP:translations.search.filters.types.licenseGroup,PRICE:translations.search.filters.types.price};namespacing.init('istock.search');istock.search.Title=Class.create({initialize:function(){Event.observe(document,istock.search.event.NEW_RESULTS,function(event){this._updateCount(this._parseResultCount(event.memo));}.bind(this));Event.observe(document,istock.search.event.UPDATE_TITLE,function(event){if(event.memo.caption){this._updateCaption(event.memo.caption);}
if(event.memo.count){this._updateCount('('+event.memo.count+')');}}.bind(this));Event.observe(document,istock.search.event.SEARCH_ERROR,function(event){if(event.memo!==istock.search.errorCodes.NO_RESULTS){this._updateCount('');}}.bind(this));Event.observe(document,istock.search.event.REMOVE_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.LIGHTBOX||event.memo.facet.type===istock.search.facetTypes.PORTFOLIO||(event.memo.facet.type===istock.search.facetTypes.COLLECTIONS&&(parseInt(event.memo.facet.value,10)===istock.search.collections.VALUE_BIN))){this._previousTitle=$('searchTitleCaption').innerHTML;this._resetTitle();}}.bind(this));Event.observe(document,istock.search.event.ADD_FACET,function(event){if(event.memo.facet.type===istock.search.facetTypes.LIGHTBOX||event.memo.facet.type===istock.search.facetTypes.PORTFOLIO||(event.memo.facet.type===istock.search.facetTypes.COLLECTIONS&&(parseInt(event.memo.facet.value,10)===istock.search.collections.VALUE_BIN))){if(!this._previousTitle.blank()){this._updateCaption(this._previousTitle);}}}.bind(this));},_updateCount:function(newCount){$('searchTitleCount').update(newCount);},_updateCaption:function(newCaption){$('searchTitleCaption').update(newCaption);},_resetTitle:function(){this._updateCaption(translations.search.defaultTitle);this._updateCount('');},_parseResultCount:function(results){return'('+((results.totalResultCount!==undefined)?results.totalResultCount:0)+')';},_previousTitle:''});Event.observe(document,'search:loaded',function(){var obj=new istock.search.Title();});namespacing.init('istock.search');istock.search.Filter=Class.create({ARROW_UP:'ctaGreyArrowUp',ARROW_DOWN:'ctaGreyArrowDown',_ele:null,initialize:function(filter){if(!Object.isUndefined(filter)){this._ele=$(filter+'_filter');}},toggleDisplay:function(filter){var f=new istock.search.Filter(filter);f.toggle();},toggle:function(){if(this._isOpen()){this.close();}else{this.open();}},open:function(){this._toggleFilter('down');},close:function(){this._toggleFilter('up');},hide:function(){this._ele.hide();},show:function(){this._ele.show();},_toggleFilter:function(direction){var removeClass=this.ARROW_UP,addClass=this.ARROW_DOWN,efct;direction=direction.toLowerCase();efct=new Effect['Blind'+direction.capitalize()](this._list(),{duration:0.2,afterUpdate:function(){document.fire(istock.search.event.TOGGLE_FILTER);}.bind(this),afterFinish:function(){document.fire(istock.search.event.TOGGLE_FILTER);}.bind(this)});if(direction==='down'){removeClass=this.ARROW_DOWN;addClass=this.ARROW_UP;}
this._getToggleLink().removeClassName(removeClass).addClassName(addClass);},_isOpen:function(){return this._list().visible();},_list:function(){return this._ele.down('.filterList');},_getToggleLink:function(){return Object.isUndefined(this._ele.down('.'+this.ARROW_DOWN))?this._ele.down('.'+this.ARROW_UP):this._ele.down('.'+this.ARROW_DOWN);}});namespacing.init('istock.search');istock.search.ZeroResults=Class.create({_errorCode:null,initialize:function(errorCode){this._errorCode=errorCode;document.fire(istock.search.event.ZERO_RESULTS);},render:function(){var zeroResults={title:'',suggestionsTitle:'',suggestions:'',categoriesTitle:'',categories:'',tipTitle:'',tipUrlText:'',tipUrl:''},title='',messages=[],categoriesInfo=[],errorDetails={},tipsInfo=[];switch(this._errorCode){case istock.search.errorCodes.LUST_FAILURE:case istock.search.errorCodes.SEARCH_FAILURE:messages.push(translations.search.zeroResults.tellUsMore);messages.push(translations.search.zeroResults.narrowYourResults);messages.push(translations.search.zeroResults.enterKeywordsInSearch);messages.push(translations.search.zeroResults.startingWithCategories);break;case istock.search.errorCodes.NO_RESULTS:default:title=translations.search.zeroResults.sorryNoResults;messages.push(translations.search.zeroResults.refineYourSearch);break;}
categoriesInfo=new istock.search.Categories().getData();tipsInfo.push(translations.search.zeroResults.forMoreHelp);tipsInfo.push(translations.search.zeroResults.searchTips);tipsInfo.push('/search/tips');errorDetails={'title':title,'messages':messages,'categoriesInfo':categoriesInfo,'tipsInfo':tipsInfo};if(errorDetails.title){zeroResults.title=errorDetails.title;}
zeroResults.suggestionsTitle=errorDetails.messages.shift();zeroResults.suggestionsHeading=errorDetails.messages.shift();errorDetails.messages.each(function(msg){zeroResults.suggestions+=(istock.search.templates.listItem.evaluate({text:msg}));});zeroResults.categoriesTitle=translations.search.zeroResults.categories;zeroResults.categoriesLeft=this._categoryText(categoriesInfo.clone().splice(0,this._halfIndex(categoriesInfo)));zeroResults.categoriesRight=this._categoryText(categoriesInfo.clone().splice(this._halfIndex(categoriesInfo),this._halfIndex(categoriesInfo)));zeroResults.tipTitle=errorDetails.tipsInfo[0];zeroResults.tipUrlText=errorDetails.tipsInfo[1];zeroResults.tipUrl=errorDetails.tipsInfo[2];return istock.search.templates.zeroResult.evaluate(zeroResults);},_categoryText:function(categories){var catText='';categories.each(function(category){if(this._errorCode===istock.search.errorCodes.NO_RESULTS){catText+=(istock.search.templates.categoryLink.evaluate({categoryId:category.id,text:category.label,url:category.url}));}else{catText+=(istock.search.templates.categoryTag.evaluate({categoryId:category.id,text:category.label,url:category.url}));}}.bind(this));return catText;},_halfIndex:function(dataArray){return parseInt(dataArray.size()/2,10);}});Object.extend(istock.search.ZeroResults,{selectCategory:function(categoryId){istock.search.event.fire(istock.search.event.ADD_FACET,new istock.search.facet.Category(categoryId,new istock.search.Categories().categoryFromId(categoryId).label));}});namespacing.init('istock.search');istock.search.Categories=Class.create({DEFAULT_LOCALE:'EN',_categories:null,initialize:function(){var locale=(Object.isUndefined(istock.siteLang))?this.DEFAULT_LOCALE:istock.siteLang;this._categories=(Object.isUndefined(istock.search.majorterms.categoryData.exportData))?istock.search.majorterms.categoryData[this.DEFAULT_LOCALE]:istock.search.majorterms.categoryData.exportData;},getData:function(){return this._categories;},categoryFromId:function(categoryId){return this._categoryFromId(this._categories,categoryId);},_categoryFromId:function(categories,categoryId){for(var i=0;i<categories.size();i++){var category=categories[i];if(category.id===categoryId){return category;}else{var c=this._categoryFromId(category.children,categoryId);if(c!==null){return c;}}}
return null;},getParent:function(child){return this._getParent(this._categories,child);},_getParent:function(categories,child){for(var i=0;i<categories.size();i++){var category=categories[i];for(var j=0;j<category.children.size();j++){compare=category.children[j];if(compare.id===child.id){return category;}else{try{return this._getParent(compare.children,child);}catch(e){}}}}
throw'Could not locate parent';}});namespacing.init('istock.search.processors');istock.search.processors.Audio=Class.create({_facetStack:null,processFacetStack:function(facetStack){this._facetStack=facetStack;if(this._needsAudioInfo()){facetStack.addFacet(istock.search.Facet.factory(istock.search.facetTypes.ADDITIONAL_AUDIO,1,''));}else{facetStack.removeFacet(istock.search.Facet.factory(istock.search.facetTypes.ADDITIONAL_AUDIO,1,''));}},_needsAudioInfo:function(){return(this._isOnlyAudioSelected()||(this._facetStack.facets(istock.search.facetTypes.FILE_TYPE).size()<1&&this._isPumpSelected())||(this._isAnyAudioFacetSelected()));},_isAnyAudioFacetSelected:function(){return(!Object.isUndefined(this._findAnyAudioFacet()));},_findAnyAudioFacet:function(){return[istock.search.facetTypes.TIME_SIGNATURE_1,istock.search.facetTypes.TIME_SIGNATURE_2,istock.search.facetTypes.KEY,istock.search.facetTypes.TEMPO,istock.search.facetTypes.AUDIO_PRICE].find(function(audioType){return this._facetStack.filters().find(function(filter){return filter.facets.find(function(facet){return facet.type===audioType;});});}.bind(this));},_isOnlyAudioSelected:function(){return(this._facetStack.facets(istock.search.facetTypes.FILE_TYPE).size()===1)&&(this._isInStack(istock.search.facetTypes.FILE_TYPE,istock.search.filters.FileType.getTypes().AUDIO));},_isPumpSelected:function(){return this._isInStack(istock.search.facetTypes.COLLECTIONS,istock.search.collections.PUMP_AUDIO);},_isInStack:function(facetType,value){return this._facetStack.isInStack(new istock.search.Facet.factory(facetType,value,''));}});Event.observe(document,'search:loaded',function(){istock.search.Handler.registerPreProcessor(new istock.search.processors.Audio());});namespacing.init('istock.search.breadbox');istock.search.breadbox.Display=Class.create({MINIMUM_HEIGHT:25,TITLE_WIDTH:140,FILTER_ORDER:[istock.search.filterTypes.LIGHTBOX,istock.search.filterTypes.PORTFOLIO,istock.search.filterTypes.KEYWORD,istock.search.filterTypes.FILE_TYPES,istock.search.filterTypes.PRICE,istock.search.filterTypes.LICENSE_GROUP,istock.search.filterTypes.PHOTO_ILLUSTRATION,istock.search.filterTypes.VIDEO,istock.search.filterTypes.AUDIO,istock.search.filterTypes.COLLECTIONS,istock.search.filterTypes.MORE_ATTRIBUTES,istock.search.filterTypes.CATEGORIES],_disambigList:[],_spellingList:[],_filters:null,initialize:function(singleRemoveCallback,allRemoveCallback){this._fireRemoveFacet=singleRemoveCallback;this._removeAllFacets=allRemoveCallback;Event.observe(document,istock.search.event.DISAMBIG_DETECTED,function(event){this._disambigList=Object.keys(event.memo);this.render(this._filters);}.bind(this));Event.observe(document,istock.search.event.SPELLING_DETECTED,function(event){this._spellingList=Object.keys(event.memo);this.render(this._filters);}.bind(this));Event.observe(document,istock.search.event.NEW_RESULTS,function(event){this._disambigList=[];this._spellingList=[];this.render(this._filters);this._highlight(false);}.bind(this));Event.observe(document,istock.search.event.SEARCH_ERROR,function(event){if(event.memo===istock.search.errorCodes.NO_RESULTS){this._highlight(true);}else{if(!this._hasFacets()){this._empty();}}}.bind(this));},render:function(filters){this._breadbox().update('');this._filters=filters;var numFacets=0;if(filters===null){return;}
var filterHash=this._organizeFilters(filters);this.FILTER_ORDER.each(function(key){filter=filterHash.get(key);if(!Object.isUndefined(filter)&&filter.facets.size()){this._renderFilter(key,filter.facets);numFacets+=filter.facets.size();}}.bind(this));if(numFacets){this._showClearAll();}else{this._hideClearAll();}
this._resetHeight();},_empty:function(){this._breadbox().insert(new Element('div',{className:'startYourSearch'}).update(translations.search.breadbox.startYourSearch));this._breadbox().setStyle({'height':'25px'});},_hasFacets:function(){var hasFacets=this._filters.find(function(filter){return filter.facets.size();});return!(Object.isUndefined(hasFacets));},_highlight:function(highlight){[this._breadbox()].invoke(((highlight)?'addClassName':'removeClassName'),'highlight');},_resetHeight:function(){this._breadbox().setStyle({'height':this._calcHeight()+'px'});this._fireRedraw();},_fireRedraw:function(){istock.search.event.fire(istock.search.event.QUERY_BUILDER_REDRAW,{'height':this._getQueryBuilderHeight()});},_getQueryBuilderHeight:function(){return $('queryBuilder').getHeight();},_organizeFilters:function(filters){var newFilter=new Hash();filters.each(function(filter){filter.facets.each(function(facet){try{this._pushFilterValue(newFilter,this._filterHeading(facet.type),facet);}catch(e){}}.bind(this));}.bind(this));return newFilter;},_pushFilterValue:function(hashFilter,key,value){if(Object.isUndefined(hashFilter.get(key))){hashFilter.set(key,{'facets':[]});}
hashFilter.get(key).facets.push(value);},_filterType:function(filter){return filter.facets.clone().pop().type;},_filterHeading:function(facetType){return istock.search.Facet.getFilterType(facetType);},_calcHeight:function(){var height=0;this._breadbox().childElements().each(function(ele){height+=ele.getHeight();});height+=35;return(height<this.MINIMUM_HEIGHT?this.MINIMUM_HEIGHT:height);},_clearAllButton:function(){if($('clearAll')===null){this._breadbox().insert({after:this._createClearAllDom()});}
return $('clearAll');},_createClearAllDom:function(){return new Element('div',{'id':'clearAll'}).update(translations.search.breadbox.clearAll).observe('click',function(e){this._removeAllFacets();}.bind(this));},_showClearAll:function(){this._clearAllButton().show();},_hideClearAll:function(){this._clearAllButton().hide();},_breadbox:function(){return $('breadbox');},_renderFilter:function(heading,data){this._breadbox().insert(this._filterContainer(heading,data));this._adjustTitleWidth();},_adjustTitleWidth:function(){$$('.facetTitle').each(function(ele){if(ele.getWidth()>this.TITLE_WIDTH){ele.writeAttribute('title',ele.collectTextNodes());}
while(ele.getWidth()>this.TITLE_WIDTH){ele.update(ele.collectTextNodes().truncate(ele.collectTextNodes().length-1));}}.bind(this));},_filterContainer:function(heading,data){var objContainer=new Element('div');objContainer.insert(new Element('div',{'class':'facetHeading'}).update(heading));data.each(function(obj){var objFacet=this._renderFacet(obj.title,obj.type);objContainer.insert(objFacet);objFacet.insert({top:this._icon(obj)});objFacet.insert({after:new Element('br',{'class':'clear'})});objFacet.insert({after:new Element('div',{'class':'facetRemove'}).insert(this._removeButton(obj))});}.bind(this));return objContainer;},_renderFacet:function(title,type){var objFacet=new Element('div',{'class':'facetTitle'}).update(title);if(this._needsSpelling(title,type)){objFacet.addClassName('spelling cp').observe('mouseover',function(e){istock.search.event.fire(istock.search.event.SPELLING_REQUESTED,objFacet,title);}.bind(this));}else if(this._needsDisambig(title,type)){objFacet.insert(this._disambigIcon()).addClassName('cp').observe('mouseover',function(e){istock.search.event.fire(istock.search.event.DISAMBIG_REQUESTED,objFacet,title);}.bind(this));}
return objFacet;},_disambigIcon:function(){return new Element('img',{'src':istock.cookielessUrl+'/static/images/blank.gif','class':'disambiguation cp'});},_needsSpelling:function(title,type){return(type===istock.search.facetTypes.KEYWORD&&this._spellingList.indexOf(title)>-1);},_needsDisambig:function(title,type){return(type===istock.search.facetTypes.KEYWORD&&this._disambigList.indexOf(title)>-1);},_removeButton:function(obj){return new Element('img',{'src':istock.cookielessUrl+'/static/images/blank.gif','class':'removeFacet cp'}).observe('click',function(ele){this._fireRemoveFacet(obj);}.bind(this));},_fileTypes:function(){return istock.search.filters.FileType.prototype.TYPES;},_icon:function(facet){var objIcon=new istock.search.breadbox.Icon(facet.type);return objIcon.generate(facet);}});namespacing.init('istock.search.breadbox');istock.search.breadbox.Icon=Class.create({initialize:function(facetType){switch(facetType){case istock.search.facetTypes.ORIENTATION:this._icon=new istock.search.breadbox.icons.Orientation();break;case istock.search.facetTypes.CATEGORY:this._icon=new istock.search.breadbox.icons.Category();break;case istock.search.facetTypes.COPY_SPACE:this._icon=new istock.search.breadbox.icons.CopySpace();break;case istock.search.facetTypes.COLOUR:this._icon=new istock.search.breadbox.icons.Colour();break;default:this._icon=null;break;}},generate:function(value){if(this._icon!==null){return this._icon.generate(value);}else{return new Element('div');}}});namespacing.init('istock.search.breadbox.icons');istock.search.breadbox.icons.FileType=Class.create({initialize:function(){},generate:function(value){var icoClass='icons ';switch(parseInt(value)){case this._fileTypes().PHOTO:icoClass+='photo';break
case this._fileTypes().ILLUSTRATION:icoClass+='vector';break;case this._fileTypes().VIDEO:icoClass+='video';break;case this._fileTypes().AUDIO:icoClass+='audio';break;case this._fileTypes().FLASH:icoClass+='flash';break;default:throw'Unknown facet value.';break;}
return new Element('img',{'src':istock.cookielessUrl+'/static/images/blank.gif','class':icoClass+' facetIcon'});},_fileTypes:function(){return istock.search.filters.FileType.prototype.TYPES;}});namespacing.init('istock.search.breadbox.icons');istock.search.breadbox.icons.CopySpace=Class.create({initialize:function(){},generate:function(facet){var iconClass='copySpaceIcon';return new Element('img',{'src':istock.cookielessUrl+'/static/images/blank.gif','class':iconClass+' mr5'});}});namespacing.init('istock.search.breadbox.icons');istock.search.breadbox.icons.Colour=Class.create({initialize:function(){},generate:function(facet){var iconClass='colourIcon';return new Element('div',{'class':iconClass+' mr5','style':'background-color: #'+facet.value});}});namespacing.init('istock.search.breadbox.icons');istock.search.breadbox.icons.Orientation=Class.create({initialize:function(){},generate:function(facet){var iconClass='';switch(parseInt(facet.value)){case this._orientTypes().HORIZONTAL:iconClass='shapeHorizontal';break;case this._orientTypes().VERTICAL:iconClass='shapeVertical';break;case this._orientTypes().SQUARE:iconClass='shapeSquare';break;default:throw'Unknown orientation.';break;}
return new Element('img',{'src':istock.cookielessUrl+'/static/images/blank.gif','class':iconClass+' mr5'});},_orientTypes:function(){return istock.search.filters.PhotoIllustration.prototype.ORIENTATION_TYPES;}});namespacing.init('istock.search.breadbox.icons');istock.search.breadbox.icons.Category=Class.create({initialize:function(){},generate:function(facet){if(facet.getDepth()>1){return new Element('div',{'class':'ml5 dil'}).update('&nbsp;');}}});namespacing.init('istock.search.majorterms.categoryData');istock.search.majorterms.categoryData.EN=[{"depth":1,"label":"Actions","id":"0_6_41|15","children":[]},{"depth":1,"label":"Animals","id":"0_6_15|15","children":[{"depth":2,"label":"Amphibians","id":"0_6_82|15","children":[]},{"depth":2,"label":"Animal Backgrounds","id":"0_6_90|15","children":[]},{"depth":2,"label":"Baby Animals","id":"0_6_87|15","children":[]},{"depth":2,"label":"Birds","id":"0_6_210|15","children":[]},{"depth":2,"label":"Cats","id":"0_6_81|15","children":[]},{"depth":2,"label":"Dogs","id":"0_6_80|15","children":[]},{"depth":2,"label":"Farm Animals","id":"0_6_83|15","children":[]},{"depth":2,"label":"Insects","id":"0_6_86|15","children":[]},{"depth":2,"label":"Mammals","id":"0_6_89|15","children":[]},{"depth":2,"label":"Reptiles","id":"0_6_88|15","children":[]},{"depth":2,"label":"Sea Life","id":"0_6_85|15","children":[]},{"depth":2,"label":"Wild Animals","id":"0_6_84|15","children":[]}]},{"depth":1,"label":"Architecture And Buildings","id":"0_6_35|15","children":[{"depth":2,"label":"Architectural Detail","id":"0_6_187|15","children":[]},{"depth":2,"label":"Architecture Abstract","id":"0_6_190|15","children":[]},{"depth":2,"label":"Architecture Backgrounds","id":"0_6_189|15","children":[]},{"depth":2,"label":"Churches","id":"0_6_186|15","children":[]},{"depth":2,"label":"Homes","id":"0_6_216|15","children":[]},{"depth":2,"label":"Monuments","id":"0_6_188|15","children":[]},{"depth":2,"label":"Office Buildings","id":"0_6_185|15","children":[]}]},{"depth":1,"label":"Arts And Entertainment","id":"0_6_33|15","children":[{"depth":2,"label":"Arts Abstract","id":"0_6_184|15","children":[]},{"depth":2,"label":"Arts Backgrounds","id":"0_6_182|15","children":[]},{"depth":2,"label":"Arts Symbols","id":"0_6_183|15","children":[]},{"depth":2,"label":"Celebrities","id":"0_6_174|15","children":[]},{"depth":2,"label":"Cinema","id":"0_6_178|15","children":[]},{"depth":2,"label":"Dance","id":"0_6_180|15","children":[]},{"depth":2,"label":"Music","id":"0_6_175|15","children":[]},{"depth":2,"label":"Opera","id":"0_6_181|15","children":[]},{"depth":2,"label":"Theatre","id":"0_6_177|15","children":[]},{"depth":2,"label":"Visual Art","id":"0_6_176|15","children":[]},{"depth":2,"label":"Writing","id":"0_6_179|15","children":[]}]},{"depth":1,"label":"Business","id":"0_6_5|15","children":[{"depth":2,"label":"Business Abstract","id":"0_6_55|15","children":[]},{"depth":2,"label":"Business Backgrounds","id":"0_6_53|15","children":[]},{"depth":2,"label":"Business Concepts","id":"0_6_48|15","children":[]},{"depth":2,"label":"Business Meetings","id":"0_6_52|15","children":[]},{"depth":2,"label":"Business People","id":"0_6_49|15","children":[]},{"depth":2,"label":"Business Symbols/Metaphors","id":"0_6_54|15","children":[]},{"depth":2,"label":"Business Teams","id":"0_6_51|15","children":[]},{"depth":2,"label":"Business Travel","id":"0_6_50|15","children":[]}]},{"depth":1,"label":"Celebrations & Holidays","id":"0_6_37|15","children":[{"depth":2,"label":"Birthdays","id":"0_6_191|15","children":[]},{"depth":2,"label":"Christmas","id":"0_6_192|15","children":[]},{"depth":2,"label":"Easter","id":"0_6_193|15","children":[]},{"depth":2,"label":"Halloween","id":"0_6_196|15","children":[]},{"depth":2,"label":"Holiday Backgrounds","id":"0_6_201|15","children":[]},{"depth":2,"label":"Holiday Symbols","id":"0_6_202|15","children":[]},{"depth":2,"label":"New Year's","id":"0_6_199|15","children":[]},{"depth":2,"label":"Parties","id":"0_6_195|15","children":[]},{"depth":2,"label":"Thanksgiving","id":"0_6_197|15","children":[]},{"depth":2,"label":"Valentine's Day","id":"0_6_200|15","children":[]},{"depth":2,"label":"Weddings","id":"0_6_194|15","children":[]}]},{"depth":1,"label":"Concepts And Ideas","id":"0_6_13|15","children":[{"depth":2,"label":"Character Traits","id":"0_6_78|15","children":[]},{"depth":2,"label":"Communication","id":"0_6_75|15","children":[]},{"depth":2,"label":"Consumerism","id":"0_6_73|15","children":[]},{"depth":2,"label":"Emotions","id":"0_6_77|15","children":[]},{"depth":2,"label":"Failure","id":"0_6_69|15","children":[]},{"depth":2,"label":"Frustration","id":"0_6_72|15","children":[]},{"depth":2,"label":"Healthy Lifestyle","id":"0_6_76|15","children":[]},{"depth":2,"label":"Modern Life","id":"0_6_66|15","children":[]},{"depth":2,"label":"Power","id":"0_6_74|15","children":[]},{"depth":2,"label":"Religion","id":"0_6_68|15","children":[]},{"depth":2,"label":"Seduction","id":"0_6_71|15","children":[]},{"depth":2,"label":"Success","id":"0_6_67|15","children":[]},{"depth":2,"label":"Teamwork","id":"0_6_70|15","children":[]},{"depth":2,"label":"Time","id":"0_6_79|15","children":[]}]},{"depth":1,"label":"Food And Drink","id":"0_6_11|15","children":[{"depth":2,"label":"Alcohol","id":"0_6_56|15","children":[]},{"depth":2,"label":"Baking","id":"0_6_64|15","children":[]},{"depth":2,"label":"Cooking","id":"0_6_60|15","children":[]},{"depth":2,"label":"Dairy Products","id":"0_6_265|15","children":[]},{"depth":2,"label":"Drinks","id":"0_6_59|15","children":[]},{"depth":2,"label":"Eating","id":"0_6_57|15","children":[]},{"depth":2,"label":"Food Backgrounds","id":"0_6_65|15","children":[]},{"depth":2,"label":"Fruits And Vegetables","id":"0_6_259|15","children":[]},{"depth":2,"label":"Grain And Cereal Products","id":"0_6_261|15","children":[]},{"depth":2,"label":"Junk Food/Fast Food","id":"0_6_267|15","children":[]},{"depth":2,"label":"Kitchen Equipment","id":"0_6_269|15","children":[]},{"depth":2,"label":"Meat And Alternatives","id":"0_6_271|15","children":[]},{"depth":2,"label":"Raw Food","id":"0_6_58|15","children":[]},{"depth":2,"label":"Studio Isolated","id":"0_6_62|15","children":[]}]},{"depth":1,"label":"Health And Beauty","id":"0_6_17|15","children":[{"depth":2,"label":"Alternative Medicine","id":"0_6_97|15","children":[]},{"depth":2,"label":"Bathroom","id":"0_6_91|15","children":[]},{"depth":2,"label":"Body","id":"0_6_212|15","children":[]},{"depth":2,"label":"Exercise","id":"0_6_92|15","children":[]},{"depth":2,"label":"Fashion","id":"0_6_93|15","children":[]},{"depth":2,"label":"Health Backgrounds","id":"0_6_99|15","children":[]},{"depth":2,"label":"Health Symbols/Metaphors","id":"0_6_100|15","children":[]},{"depth":2,"label":"Makeup/Cosmetics","id":"0_6_95|15","children":[]},{"depth":2,"label":"Massage","id":"0_6_96|15","children":[]},{"depth":2,"label":"Medicine","id":"0_6_98|15","children":[]},{"depth":2,"label":"Sexuality","id":"0_6_94|15","children":[]}]},{"depth":1,"label":"Illustrations/Vectors","id":"0_6_19|15","children":[{"depth":2,"label":"Vector Backgrounds","id":"0_6_218|15","children":[]},{"depth":2,"label":"Vector Cartoons","id":"0_6_226|15","children":[]},{"depth":2,"label":"Vector Florals","id":"0_6_220|15","children":[]},{"depth":2,"label":"Vector Icons","id":"0_6_224|15","children":[]},{"depth":2,"label":"Vector Ornaments","id":"0_6_222|15","children":[]}]},{"depth":1,"label":"Industry","id":"0_6_232|15","children":[{"depth":2,"label":"Agriculture","id":"0_6_253|15","children":[]},{"depth":2,"label":"Construction","id":"0_6_236|15","children":[]},{"depth":2,"label":"Education","id":"0_6_248|15","children":[]},{"depth":2,"label":"Government","id":"0_6_252|15","children":[]},{"depth":2,"label":"Health Care","id":"0_6_250|15","children":[]},{"depth":2,"label":"Heavy Industry","id":"0_6_238|15","children":[]},{"depth":2,"label":"Law Enforcement And Crime","id":"0_6_239|15","children":[]},{"depth":2,"label":"Manufacturing","id":"0_6_246|15","children":[]},{"depth":2,"label":"Retail/Service Industry","id":"0_6_255|15","children":[]}]},{"depth":1,"label":"Isolated Objects","id":"0_6_39|15","children":[{"depth":2,"label":"Isolated-Background Objects","id":"0_6_203|15","children":[]},{"depth":2,"label":"Objects with Clipping Paths","id":"0_6_204|15","children":[]}]},{"depth":1,"label":"Lifestyle","id":"0_6_23|15","children":[{"depth":2,"label":"Adults","id":"0_6_124|15","children":[]},{"depth":2,"label":"Children","id":"0_6_128|15","children":[]},{"depth":2,"label":"Families","id":"0_6_122|15","children":[]},{"depth":2,"label":"Gay","id":"0_6_123|15","children":[]},{"depth":2,"label":"Lifestyle Backgrounds","id":"0_6_129|15","children":[]},{"depth":2,"label":"Relationships","id":"0_6_130|15","children":[]},{"depth":2,"label":"Seniors","id":"0_6_127|15","children":[]},{"depth":2,"label":"Teens","id":"0_6_125|15","children":[]},{"depth":2,"label":"Young Adults","id":"0_6_126|15","children":[]}]},{"depth":1,"label":"Locations And Travel","id":"0_6_31|15","children":[{"depth":2,"label":"Air Travel","id":"0_6_171|15","children":[]},{"depth":2,"label":"Beaches","id":"0_6_166|15","children":[]},{"depth":2,"label":"Holidays","id":"0_6_167|15","children":[]},{"depth":2,"label":"Landmarks","id":"0_6_165|15","children":[]},{"depth":2,"label":"Railway","id":"0_6_172|15","children":[]},{"depth":2,"label":"Subway","id":"0_6_170|15","children":[]},{"depth":2,"label":"Travel Backgrounds","id":"0_6_173|15","children":[]}]},{"depth":1,"label":"Nature","id":"0_6_25|15","children":[{"depth":2,"label":"Bodies Of Water","id":"0_6_139|15","children":[]},{"depth":2,"label":"Fall","id":"0_6_138|15","children":[]},{"depth":2,"label":"Flowers","id":"0_6_132|15","children":[]},{"depth":2,"label":"Gardens","id":"0_6_134|15","children":[]},{"depth":2,"label":"Geological Feature","id":"0_6_257|15","children":[]},{"depth":2,"label":"Landscapes","id":"0_6_133|15","children":[]},{"depth":2,"label":"Nature Abstract","id":"0_6_143|15","children":[]},{"depth":2,"label":"Nature Backgrounds","id":"0_6_141|15","children":[]},{"depth":2,"label":"Nature Symbols/Metaphors","id":"0_6_142|15","children":[]},{"depth":2,"label":"Panoramas","id":"0_6_140|15","children":[]},{"depth":2,"label":"Plants","id":"0_6_131|15","children":[]},{"depth":2,"label":"Spring","id":"0_6_137|15","children":[]},{"depth":2,"label":"Summer","id":"0_6_135|15","children":[]},{"depth":2,"label":"Winter","id":"0_6_136|15","children":[]}]},{"depth":1,"label":"Objects/Equipment","id":"0_6_45|15","children":[{"depth":2,"label":"Household Objects/Equipment","id":"0_6_228|15","children":[]},{"depth":2,"label":"Industrial Objects/Equipment","id":"0_6_230|15","children":[]}]},{"depth":1,"label":"People","id":"0_6_47|15","children":[]},{"depth":1,"label":"Science And Medicine","id":"0_6_27|15","children":[{"depth":2,"label":"Dental","id":"0_6_144|15","children":[]},{"depth":2,"label":"Drugs/Pills","id":"0_6_146|15","children":[]},{"depth":2,"label":"Equipment","id":"0_6_149|15","children":[]},{"depth":2,"label":"Medical","id":"0_6_145|15","children":[]},{"depth":2,"label":"Optometry","id":"0_6_154|15","children":[]},{"depth":2,"label":"Personnel","id":"0_6_150|15","children":[]},{"depth":2,"label":"Recreational Drugs","id":"0_6_147|15","children":[]},{"depth":2,"label":"Research","id":"0_6_148|15","children":[]},{"depth":2,"label":"Science Abstract","id":"0_6_152|15","children":[]},{"depth":2,"label":"Science Backgrounds","id":"0_6_151|15","children":[]},{"depth":2,"label":"Science Symbols/Metaphors","id":"0_6_153|15","children":[]}]},{"depth":1,"label":"Sports And Leisure","id":"0_6_29|15","children":[{"depth":2,"label":"Competition","id":"0_6_161|15","children":[]},{"depth":2,"label":"Extreme Sports","id":"0_6_162|15","children":[]},{"depth":2,"label":"Fitness","id":"0_6_157|15","children":[]},{"depth":2,"label":"Golf","id":"0_6_160|15","children":[]},{"depth":2,"label":"Individual Sports","id":"0_6_156|15","children":[]},{"depth":2,"label":"Sports Backgrounds","id":"0_6_163|15","children":[]},{"depth":2,"label":"Sports Symbols/Metaphors","id":"0_6_164|15","children":[]},{"depth":2,"label":"Team Sports","id":"0_6_155|15","children":[]},{"depth":2,"label":"Water","id":"0_6_158|15","children":[]}]},{"depth":1,"label":"Technology","id":"0_6_234|15","children":[{"depth":2,"label":"Communications Technology","id":"0_6_235|15","children":[]},{"depth":2,"label":"Computers","id":"0_6_240|15","children":[]},{"depth":2,"label":"Electronics","id":"0_6_237|15","children":[]},{"depth":2,"label":"Technology Abstract","id":"0_6_241|15","children":[]},{"depth":2,"label":"Technology Backgrounds","id":"0_6_242|15","children":[]},{"depth":2,"label":"Technology Symbols/Metaphors","id":"0_6_243|15","children":[]}]},{"depth":1,"label":"Transportation","id":"0_6_208|15","children":[]},{"depth":1,"label":"Musical Instrument","id":"1_165","children":[{"depth":2,"label":"Hurdy-Gurdy","id":"0_1_188216|165","children":[]},{"depth":2,"label":"Keyboard Instrument","id":"0_1_2718|165","children":[]},{"depth":2,"label":"Musical Instrument Parts","id":"0_5_64|165","children":[]},{"depth":2,"label":"Percussion Instrument","id":"0_1_2732|165","children":[]},{"depth":2,"label":"String Instrument","id":"0_1_2719|165","children":[]},{"depth":2,"label":"Theremin","id":"0_1_194867|165","children":[]},{"depth":2,"label":"Thumb Piano","id":"0_1_194916|165","children":[]},{"depth":2,"label":"Tubular Bells","id":"0_1_277152|165","children":[]},{"depth":2,"label":"Vocoder","id":"0_5_2416|165","children":[]},{"depth":2,"label":"Wind Instrument","id":"0_1_2729|165","children":[]}]},{"depth":1,"label":"Musical Genre","id":"1_125","children":[{"depth":2,"label":"Ambient","id":"0_5_1771|125","children":[]},{"depth":2,"label":"Blues","id":"0_1_24974|125","children":[]},{"depth":2,"label":"Calypso Music","id":"0_1_52683|125","children":[]},{"depth":2,"label":"Classical Music","id":"0_1_219883|125","children":[]},{"depth":2,"label":"Country and Western Music","id":"0_1_52685|125","children":[]},{"depth":2,"label":"Dance And Electronic","id":"0_1_359863|125","children":[]},{"depth":2,"label":"Easy Listening","id":"0_5_1831|125","children":[]},{"depth":2,"label":"Experimental Music","id":"0_5_2802|125","children":[]},{"depth":2,"label":"Folk Music","id":"0_1_24977|125","children":[]},{"depth":2,"label":"Funk Music","id":"0_5_2069|125","children":[]},{"depth":2,"label":"Gospel","id":"0_1_24973|125","children":[]},{"depth":2,"label":"Hip Hop","id":"0_5_1839|125","children":[]},{"depth":2,"label":"Jazz","id":"0_1_24971|125","children":[]},{"depth":2,"label":"Khoomei","id":"0_1_224458|125","children":[]},{"depth":2,"label":"Latin Music","id":"0_1_52688|125","children":[]},{"depth":2,"label":"Other Music","id":"0_5_1896|125","children":[]},{"depth":2,"label":"Pop","id":"0_5_1912|125","children":[]},{"depth":2,"label":"Rap","id":"0_1_196919|125","children":[]},{"depth":2,"label":"Reggae","id":"0_1_52583|125","children":[]},{"depth":2,"label":"Rock and Roll","id":"0_1_178422|125","children":[]},{"depth":2,"label":"Skiffle Music","id":"0_1_52599|125","children":[]},{"depth":2,"label":"World Music","id":"0_1_52693|125","children":[]},{"depth":2,"label":"Zydeco","id":"0_1_420834|125","children":[]},{"depth":2,"label":"Cinematic","id":"1_168","children":[]},{"depth":2,"label":"Comic Music","id":"1_171","children":[]},{"depth":2,"label":"Sports Music","id":"1_174","children":[]},{"depth":2,"label":"Horror Music","id":"1_177","children":[]}]},{"depth":1,"label":"Non-Musical Sound","id":"1_126","children":[{"depth":2,"label":"Animals","id":"1_127","children":[]},{"depth":2,"label":"Appliances","id":"1_128","children":[]},{"depth":2,"label":"Bars & Restaurants","id":"1_129","children":[]},{"depth":2,"label":"Buttons, Clicks & Rollovers","id":"1_130","children":[]},{"depth":2,"label":"Cartoon & Animation Effects","id":"1_131","children":[]},{"depth":2,"label":"Classroom","id":"1_132","children":[]},{"depth":2,"label":"Crowd Sounds","id":"1_133","children":[]},{"depth":2,"label":"Doors","id":"1_134","children":[]},{"depth":2,"label":"Electronics","id":"1_135","children":[]},{"depth":2,"label":"Electronic Tone Generation","id":"1_136","children":[]},{"depth":2,"label":"Emergency","id":"1_137","children":[]},{"depth":2,"label":"Fantasy","id":"1_138","children":[]},{"depth":2,"label":"Film Effects","id":"1_139","children":[]},{"depth":2,"label":"Fire & Explosions","id":"1_140","children":[]},{"depth":2,"label":"Guns & Weapons","id":"1_141","children":[]},{"depth":2,"label":"Horror Sounds","id":"1_142","children":[]},{"depth":2,"label":"Household","id":"1_143","children":[]},{"depth":2,"label":"Human Sounds","id":"1_144","children":[]},{"depth":2,"label":"Industrial & Machinery","id":"1_146","children":[]},{"depth":2,"label":"Metallic","id":"1_147","children":[]},{"depth":2,"label":"Multimedia & Presentations","id":"1_148","children":[]},{"depth":2,"label":"Nature","id":"1_149","children":[]},{"depth":2,"label":"Object Sounds","id":"1_150","children":[]},{"depth":2,"label":"Office","id":"1_151","children":[]},{"depth":2,"label":"Ring Tones","id":"1_152","children":[]},{"depth":2,"label":"Science Fiction","id":"1_153","children":[]},{"depth":2,"label":"Sports","id":"1_154","children":[]},{"depth":2,"label":"Stone","id":"1_155","children":[]},{"depth":2,"label":"Technology","id":"1_156","children":[]},{"depth":2,"label":"Tools","id":"1_157","children":[]},{"depth":2,"label":"Toys","id":"1_158","children":[]},{"depth":2,"label":"Transitional Sounds","id":"1_159","children":[]},{"depth":2,"label":"Transport & Vehicles","id":"1_160","children":[]},{"depth":2,"label":"Water","id":"1_161","children":[]},{"depth":2,"label":"Weather","id":"1_162","children":[]},{"depth":2,"label":"Wood","id":"1_163","children":[]}]}];namespacing.init('istock.search.email');istock.search.email.OptInLink=Class.create({initialize:function(){$(istock.search.email.OptInLink.ELEMENT_ID).update(this._optInLink());},_optInLink:function(){return translations.search.email.optInText+'<a target="_blank" href="/my-account/preferences/index/active-tab/notification">'+
translations.search.email.optInLink+'</a>';}});Object.extend(istock.search.email.OptInLink,{ELEMENT_ID:'emailOptIn',show:function(){$(this.ELEMENT_ID).show();},hide:function(){$(this.ELEMENT_ID).hide();}});Event.observe(document,'search:loaded',function(){var obj=new istock.search.email.OptInLink()});document.fire("search:loaded");});